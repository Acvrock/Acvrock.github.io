<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>静宏的 blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="纪录、分享、回顾">
<meta property="og:type" content="website">
<meta property="og:title" content="静宏的 blog">
<meta property="og:url" content="http://www.Acvrock.com/index.html">
<meta property="og:site_name" content="静宏的 blog">
<meta property="og:description" content="纪录、分享、回顾">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="静宏的 blog">
<meta name="twitter:description" content="纪录、分享、回顾">
  
    <link rel="alternative" href="/atom.xml" title="静宏的 blog" type="application/atom+xml">
  
  
    <!-- <link rel="icon" href="//favicon.ico"> -->
    <link rel="icon" href="/favicon.ico">
  
  <script src="/style.js"></script>
</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="/develop-web.png" class="js-avatar show">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">静宏</a></h1>
		</hgroup>

		
		<p class="header-subtitle">垂死病中惊卧起，谈笑风生又一年</p>
		

		<nav class="header-menu">
			<ul>
			
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/Acvrock" title="github">github</a>
		        
					<a class="weibo" target="_blank" href="http://weibo.com/jinghong1994/" title="weibo">weibo</a>
		        
					<a class="twitter" target="_blank" href="https://twitter.com/li1215101" title="twitter">twitter</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">静宏</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="/develop-web.png" class="js-avatar show">
				
			</div>
			<hgroup>
			  <h1 class="header-author">静宏</h1>
			</hgroup>
			
			<p class="header-subtitle">垂死病中惊卧起，谈笑风生又一年</p>
			
			<nav class="header-menu">
				<ul>
				
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Acvrock" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/jinghong1994/" title="weibo">weibo</a>
			        
						<a class="twitter" target="_blank" href="https://twitter.com/li1215101" title="twitter">twitter</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-fix_guava_eventBus_reprocessing" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/11/fix_guava_eventBus_reprocessing/">定位 Guava EventBus 重复消费</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3>问题描述</h3>
<p>我们在系统中使用 Guava 的 EventBus 进行代码解耦，一直运行良好，但是在某一次发版后，出现了消息重复消费的情况，示例代码如下:</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">AbstractListener.java <span class="comment">//抽象父类</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractListener</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">InitializingBean</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> </span>&#123;  <span class="comment">//系统初始化时进行消费者注册</span></div><div class="line">		GuavaEventBusFactory.getDefault().eventBus().register(<span class="keyword">this</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(T t)</span> <span class="keyword">throws</span> Exception</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">CallNotifyListener.java <span class="comment">//具体业务类，对事件进行消费</span></div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="meta">@Lazy</span>(<span class="keyword">false</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallNotifyListener</span> <span class="keyword">extends</span> <span class="title">AbstractListener</span>&lt;<span class="title">CallBack</span>&gt; </span>&#123;</div><div class="line">	Logger logger = LoggerFactory.getLogger(CallNotifyListener.class);</div><div class="line"></div><div class="line">	<span class="meta">@Subscribe</span></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(CallBack event)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		logger.info(<span class="string">"CallNotifyListener onEvent :&#123;&#125;,&#123;&#125;"</span>, event.getAppid(),event);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">ScheduledTasks.java <span class="comment">//事件生产者</span></div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledTasks</span> </span>&#123;</div><div class="line">	Logger logger = LoggerFactory.getLogger(ScheduledTasks.class);</div><div class="line"></div><div class="line">	<span class="meta">@Scheduled</span>(fixedRate = <span class="number">2000</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scheduleTaskWithFixedRate</span><span class="params">()</span> </span>&#123;</div><div class="line">		logger.info(<span class="string">"send msg - &#123;&#125;"</span>,<span class="keyword">new</span> Date());</div><div class="line">		CallBack callBack = <span class="keyword">new</span> CallBack(<span class="number">1</span>,System.currentTimeMillis());</div><div class="line">		GuavaEventBusFactory.getDefault().eventBus().post(callBack);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>预期执行情况：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">2018-08-11 20:49:22.728  INFO 27619 --- [           main] c.a.eventbus.EventBusTestApplication     : Started EventBusTestApplication in 1.476 seconds (JVM running for 1.848)</div><div class="line">2018-08-11 20:49:24.724  INFO 27619 --- [pool-2-thread-1] com.acvrock.eventbus.ScheduledTasks      : send msg - Sat Aug 11 20:49:24 CST 2018</div><div class="line">2018-08-11 20:49:24.725  INFO 27619 --- [pool-1-thread-2] com.acvrock.eventbus.CallNotifyListener  : CallNotifyListener onEvent :1533991764724,CallBack&#123;chid=1, appid=1533991764724&#125;</div><div class="line">2018-08-11 20:49:26.726  INFO 27619 --- [pool-2-thread-1] com.acvrock.eventbus.ScheduledTasks      : send msg - Sat Aug 11 20:49:26 CST 2018</div><div class="line">2018-08-11 20:49:26.727  INFO 27619 --- [pool-1-thread-3] com.acvrock.eventbus.CallNotifyListener  : CallNotifyListener onEvent :1533991766727,CallBack&#123;chid=1, appid=1533991766727&#125;</div></pre></td></tr></table></figure></p>
<p>实际执行情况：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">2018-08-11 20:51:20.279  INFO 27674 --- [           main] c.a.eventbus.EventBusTestApplication     : Started EventBusTestApplication in 1.062 seconds (JVM running for 1.442)</div><div class="line">2018-08-11 20:51:22.271  INFO 27674 --- [pool-2-thread-1] com.acvrock.eventbus.ScheduledTasks      : send msg - Sat Aug 11 20:51:22 CST 2018</div><div class="line">2018-08-11 20:51:22.272  INFO 27674 --- [pool-1-thread-3] com.acvrock.eventbus.CallNotifyListener  : CallNotifyListener onEvent :1533991882271,CallBack&#123;chid=1, appid=1533991882271&#125;</div><div class="line">2018-08-11 20:51:22.272  INFO 27674 --- [pool-1-thread-4] com.acvrock.eventbus.CallNotifyListener  : CallNotifyListener onEvent :1533991882271,CallBack&#123;chid=1, appid=1533991882271&#125;</div><div class="line">2018-08-11 20:51:24.275  INFO 27674 --- [pool-2-thread-1] com.acvrock.eventbus.ScheduledTasks      : send msg - Sat Aug 11 20:51:24 CST 2018</div><div class="line">2018-08-11 20:51:24.275  INFO 27674 --- [pool-1-thread-2] com.acvrock.eventbus.CallNotifyListener  : CallNotifyListener onEvent :1533991884275,CallBack&#123;chid=1, appid=1533991884275&#125;</div><div class="line">2018-08-11 20:51:24.275  INFO 27674 --- [pool-1-thread-5] com.acvrock.eventbus.CallNotifyListener  : CallNotifyListener onEvent :1533991884275,CallBack&#123;chid=1, appid=1533991884275&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到消费者对事件消费了两次，但是通过检查代码发现并没有相关的改动，机器环境也没有变动。<br>
经过一番定位后发现是编译机器 JDK 版本升级到 JDK 8，新版 javac 编译后字节码有变动。<br>
导致相同代码和环境下出现了不同的行为。</p>
<h3>定位过程：</h3>
<p>对代码调用进行跟踪，先从 EventBus.post 方法看起</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">post</span><span class="params">(Object event)</span> </span>&#123;</div><div class="line">    Set&lt;Class&lt;?&gt;&gt; dispatchTypes = flattenHierarchy(event.getClass());</div><div class="line"></div><div class="line">    <span class="keyword">boolean</span> dispatched = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">for</span> (Class&lt;?&gt; eventType : dispatchTypes) &#123;</div><div class="line">      subscribersByTypeLock.readLock().lock();</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">        Set&lt;EventSubscriber&gt; wrappers = subscribersByType.get(eventType);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!wrappers.isEmpty()) &#123;</div><div class="line">          dispatched = <span class="keyword">true</span>;</div><div class="line">          <span class="keyword">for</span> (EventSubscriber wrapper : wrappers) &#123;</div><div class="line">            enqueueEvent(event, wrapper);</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125; <span class="keyword">finally</span> &#123;</div><div class="line">        subscribersByTypeLock.readLock().unlock();</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!dispatched &amp;&amp; !(event <span class="keyword">instanceof</span> DeadEvent)) &#123;</div><div class="line">      post(<span class="keyword">new</span> DeadEvent(<span class="keyword">this</span>, event));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    dispatchQueuedEvents();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>debug 时发现在 JDK 7 环境下，subscribersByType.get(eventType) 只能获取到一个 EventSubscriber 对象，即：onEvent(CallBack event)。<br>
而在 JDK 8 环境下，subscribersByType.get(eventType) 的确能够获取到两个 EventSubscriber 对象，分别是：onEvent(CallBack event)和onEvent(Object o)，
导致 enqueueEvent 了两次<br>
subscribersByType 对象是一个类似 Map 结构，用于存储 EventSubscriber 对象，初始化数据的位置在 EventBus.register中：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Object object)</span> </span>&#123;</div><div class="line">   Multimap&lt;Class&lt;?&gt;, EventSubscriber&gt; methodsInListener =</div><div class="line">       finder.findAllSubscribers(object);</div><div class="line">   subscribersByTypeLock.writeLock().lock();</div><div class="line">   <span class="keyword">try</span> &#123;</div><div class="line">     subscribersByType.putAll(methodsInListener);</div><div class="line">   &#125; <span class="keyword">finally</span> &#123;</div><div class="line">     subscribersByTypeLock.writeLock().unlock();</div><div class="line">   &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>这里 findAllSubscribers 的实现是在 AnnotatedSubscriberFinder 类中，逻辑比较简单，先调用  getAnnotatedMethods(clazz) 获取类中有 @Subscribe 注解的方法列表，然后实例化成 EventSubscriber 对象，存进 methodsInListener 并返回。<br>
JDK 7 环境下 getAnnotatedMethods(clazz) 返回了 onEvent(CallBack event) 方法<br>
JDK 8 环境下 getAnnotatedMethods(clazz) 返回了 onEvent(CallBack event) 方法和 onEvent(Object o) 方法，但是 onEvent(Object o) 不是我们定义的方法，而是 JDK 实现泛型时生成的桥方法，可以看成是在父类中定义的 onEvent(T t) 擦除泛型转换而来，并没有带 @Subscribe</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> Multimap&lt;Class&lt;?&gt;, EventSubscriber&gt; findAllSubscribers(Object listener) &#123;</div><div class="line">  Multimap&lt;Class&lt;?&gt;, EventSubscriber&gt; methodsInListener = HashMultimap.create();</div><div class="line">  Class&lt;?&gt; clazz = listener.getClass();</div><div class="line">  <span class="keyword">for</span> (Method method : getAnnotatedMethods(clazz)) &#123;</div><div class="line">    Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</div><div class="line">    Class&lt;?&gt; eventType = parameterTypes[<span class="number">0</span>];</div><div class="line">    EventSubscriber subscriber = makeSubscriber(listener, method);</div><div class="line">    methodsInListener.put(eventType, subscriber);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> methodsInListener;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>getAnnotatedMethods(clazz) 方法中使用了 LoadingCache 缓存，最后获取注解的方法是：getAnnotatedMethodsInternal</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ImmutableList&lt;Method&gt; <span class="title">getAnnotatedMethodsInternal</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</div><div class="line">   Set&lt;? extends Class&lt;?&gt;&gt; supers = TypeToken.of(clazz).getTypes().rawTypes();</div><div class="line">   Map&lt;MethodIdentifier, Method&gt; identifiers = Maps.newHashMap();</div><div class="line">   <span class="keyword">for</span> (Class&lt;?&gt; superClazz : supers) &#123;</div><div class="line">     <span class="keyword">for</span> (Method superClazzMethod : superClazz.getMethods()) &#123;</div><div class="line">       <span class="keyword">if</span> (superClazzMethod.isAnnotationPresent(Subscribe.class)) &#123;</div><div class="line">         Class&lt;?&gt;[] parameterTypes = superClazzMethod.getParameterTypes();</div><div class="line">         <span class="keyword">if</span> (parameterTypes.length != <span class="number">1</span>) &#123;</div><div class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Method "</span> + superClazzMethod</div><div class="line">               + <span class="string">" has @Subscribe annotation, but requires "</span> + parameterTypes.length</div><div class="line">               + <span class="string">" arguments.  Event subscriber methods must require a single argument."</span>);</div><div class="line">         &#125;</div><div class="line">         </div><div class="line">         MethodIdentifier ident = <span class="keyword">new</span> MethodIdentifier(superClazzMethod);</div><div class="line">         <span class="keyword">if</span> (!identifiers.containsKey(ident)) &#123;</div><div class="line">           identifiers.put(ident, superClazzMethod);</div><div class="line">         &#125;</div><div class="line">       &#125;</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">return</span> ImmutableList.copyOf(identifiers.values());</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>这里关键的一句判断是 superClazzMethod.isAnnotationPresent(Subscribe.class)，isAnnotationPresent是 JDK reflect 包中的方法，经过调试，发现在 JDK 7 中，</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">onEvent(CallBack event) 方法返回 true，</div><div class="line">onEvent(Object o) 方法返回 false，</div></pre></td></tr></table></figure></p>
<p>而在 JDK 8 中，</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">onEvent(CallBack event) 方法返回 true，</div><div class="line">onEvent(Object o) 方法返回 true。</div></pre></td></tr></table></figure></p>
<p>导致返回了 onEvent(CallBack event) 和 onEvent(Object o)，并初始化出两个 EventSubscriber。</p>
<h3>原因</h3>
<p>对比两个版本 javac 编译出来的字节码</p>
<p>JDK 7 版本</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"> g6763$ javap -v  CallNotifyListener.class</div><div class="line">...</div><div class="line">public class com.acvrock.eventbus.CallNotifyListener extends com.acvrock.eventbus.AbstractListener&lt;com.acvrock.eventbus.CallBack&gt;</div><div class="line">  minor version: 0</div><div class="line">  major version: 51</div><div class="line">  flags: ACC_PUBLIC, ACC_SUPER</div><div class="line">Constant pool:</div><div class="line">   ...</div><div class="line">  #26 = Utf8               RuntimeVisibleAnnotations</div><div class="line">  #27 = Utf8               Lcom/google/common/eventbus/Subscribe;</div><div class="line">  #28 = Utf8               (Ljava/lang/Object;)V</div><div class="line">  ...</div><div class="line">&#123;</div><div class="line">  ...</div><div class="line"></div><div class="line">  public void onEvent(com.acvrock.eventbus.CallBack) throws java.lang.Exception;</div><div class="line">    ...</div><div class="line">    Exceptions:</div><div class="line">      throws java.lang.Exception</div><div class="line">    RuntimeVisibleAnnotations:</div><div class="line">      0: #27()</div><div class="line"></div><div class="line">  public void onEvent(java.lang.Object) throws java.lang.Exception;</div><div class="line">    ...</div><div class="line">    Exceptions:</div><div class="line">      throws java.lang.Exception</div><div class="line">&#125;</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>第一个方法 onEvent(com.acvrock.guavatest.CallBack) 有一个 <code>#27</code> Subscribe 运行时注解
第二个方法 onEvent(java.lang.Object) 没有带 RuntimeVisibleAnnotations</p>
<p>JDK 8 版本</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">g6763$ javap -v  CallNotifyListener.class </div><div class="line">...</div><div class="line">public class com.acvrock.eventbus.CallNotifyListener extends com.acvrock.eventbus.AbstractListener&lt;com.acvrock.eventbus.CallBack&gt;</div><div class="line">  minor version: 0</div><div class="line">  major version: 51</div><div class="line">  flags: ACC_PUBLIC, ACC_SUPER</div><div class="line">Constant pool:</div><div class="line">  ...</div><div class="line">  #26 = Utf8               RuntimeVisibleAnnotations</div><div class="line">  #27 = Utf8               Lcom/google/common/eventbus/Subscribe;</div><div class="line">  #28 = Utf8               (Ljava/lang/Object;)V</div><div class="line">  ...</div><div class="line">  </div><div class="line">&#123;</div><div class="line">  ...</div><div class="line">  </div><div class="line">  public void onEvent(com.acvrock.eventbus.CallBack) throws java.lang.Exception;</div><div class="line">    ...</div><div class="line">    Exceptions:</div><div class="line">      throws java.lang.Exception</div><div class="line">    RuntimeVisibleAnnotations:</div><div class="line">      0: #27()</div><div class="line"></div><div class="line">  public void onEvent(java.lang.Object) throws java.lang.Exception;</div><div class="line">    ...</div><div class="line">    Exceptions:</div><div class="line">      throws java.lang.Exception</div><div class="line">    RuntimeVisibleAnnotations:</div><div class="line">      0: #27()</div><div class="line">&#125;</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>两个方法都有 运行时注解  <code>#27()</code>，也就是 <code>Subscribe</code><br>
在网上 <a href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=8029563" target="_blank" rel="external">JDK-8029563 : Method.getAnnotations() changed its return value in JDK 8.</a> 这个描述和我们发现的问题是一致的<br>
导致这一变动的是这个调整
<a href="https://bugs.java.com/view_bug.do?bug_id=JDK-6695379" target="_blank" rel="external">JDK-6695379 : Copy method annotations and parameter annotations to synthetic bridge methods</a>，
javac 实现了在编译时，拷贝方法和参数上的注解到桥方法上，也就是 onEvent(java.lang.Object)上，在 JDK 7u80 和 JDK 8b94 后生效</p>
<h3>guava 如何解决</h3>
<p>在 guava 18 中就已经解决了这个问题，代码如下：</p>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ImmutableList&lt;Method&gt; <span class="title">getAnnotatedMethodsInternal</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</div><div class="line">    Set&lt;? extends Class&lt;?&gt;&gt; supers = TypeToken.of(clazz).getTypes().rawTypes();</div><div class="line">    Map&lt;MethodIdentifier, Method&gt; identifiers = Maps.newHashMap();</div><div class="line">    <span class="keyword">for</span> (Class&lt;?&gt; superClazz : supers) &#123;</div><div class="line">      <span class="keyword">for</span> (Method superClazzMethod : superClazz.getMethods()) &#123;</div><div class="line">        <span class="keyword">if</span> (superClazzMethod.isAnnotationPresent(Subscribe.class)</div><div class="line">            &amp;&amp; !superClazzMethod.isBridge()) &#123;</div><div class="line">          Class&lt;?&gt;[] parameterTypes = superClazzMethod.getParameterTypes();</div><div class="line">          <span class="keyword">if</span> (parameterTypes.length != <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Method "</span> + superClazzMethod</div><div class="line">                + <span class="string">" has @Subscribe annotation, but requires "</span> + parameterTypes.length</div><div class="line">                + <span class="string">" arguments.  Event subscriber methods must require a single argument."</span>);</div><div class="line">          &#125;</div><div class="line"></div><div class="line">          MethodIdentifier ident = <span class="keyword">new</span> MethodIdentifier(superClazzMethod);</div><div class="line">          <span class="keyword">if</span> (!identifiers.containsKey(ident)) &#123;</div><div class="line">            identifiers.put(ident, superClazzMethod);</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ImmutableList.copyOf(identifiers.values());</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>判断了方法有 Subscribe 注解并且不是桥方法才认为是 subscribe 方法,对应的代码提交记录：
<a href="https://github.com/google/guava/commit/32d7dc732dfee93c82942e2d776adbbc02bd85ba#diff-e3fca3176dda68793f07e756ca2f412c" target="_blank" rel="external">Fix EventBus to not include bridge methods when registering subscribe</a><br>
真是一个摸不着头脑的 bug</p>
<h4>参考</h4>
<p>关于桥方法可以参考
<a href="https://docs.oracle.com/javase/tutorial/java/generics/bridgeMethods.html" target="_blank" rel="external">Effects of Type Erasure and Bridge Methods</a><br>
示例代码<a href="https://github.com/Acvrock/Exercise-code/tree/master/eventbusTest" target="_blank" rel="external">Exercise-code/eventbusTest</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2018/08/11/fix_guava_eventBus_reprocessing/" class="archive-article-date">
  	<time datetime="2018-08-11T06:54:38.000Z" itemprop="datePublished"><i class="icon-clock"></i>2018-08-11</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/EventBus/">EventBus</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Guava/">Guava</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JDK-8/">JDK 8</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Method-getAnnotations/">Method.getAnnotations()</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-20180117_2017-2018" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/17/20180117_2017-2018/">静宏的 2017 -&gt; 2018</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3>一.2017 总结</h3>
<p>2017 最大的变化是换了新公司，原公司因为一些原因暂停营业，加入 <a href="http://www.100.com" target="_blank" rel="external">100 教育</a></p>
<h4>成果</h4>
<ul>
<li>
<p>工作<br>
高频的需求迭代，学习更强的时间管理能力，不轻易陷进代码实现细节，导致进度的拖延<br>
相比完善的基础服务和运维环境，助力解放开发过程中繁琐的环境搭建/配置/监控，大开眼界</p>
</li>
<li>
<p>学习<br>
对 go 语言进行学习，初步掌握语法概念，需要找一个适当的项目进行练手<br>
看了一部分 mybatis 代码，抄了部分代码实现一个动态接口方法调用功能，感觉良好</p>
</li>
</ul>
<h3>二.2018 展望</h3>
<ol>
<li>把家里攒的书都看一遍</li>
<li>对 Spring stack 深入了解，特别是 spring 5</li>
<li>Kotlin 看起来很诱惑，接触</li>
</ol>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2018/01/17/20180117_2017-2018/" class="archive-article-date">
  	<time datetime="2018-01-17T13:34:11.000Z" itemprop="datePublished"><i class="icon-clock"></i>2018-01-17</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/总结/">总结</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-fix_timeout_due_to_cpu_busy" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/20/fix_timeout_due_to_cpu_busy/">记一次 CPU 忙碌导致的超时</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>通过业务日志发现客户端调用某一远程服务时不时连接超时,导致部分业务请求受影响,以下记录了定位的过程<br>
首先收集 thrift 代理日志,统计该服务超时情况,结果如下:</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">**@ubuntu:/data/log/ServiceAgent_d$ zgrep &apos;time out&apos; ServiceAgent_d.log.*.gz |awk &apos;&#123;print $3,$7,$12&#125;&apos;|grep od</div><div class="line">11:11:20 od_getById ***.***.112.152_60008</div><div class="line">14:11:25 od_listByParam ***.***.112.152_60008</div><div class="line">19:11:25 od_getById ***.***.112.152_60008</div><div class="line">19:11:27 od_getById ***.***.112.152_60008</div><div class="line">00:12:02 od_ping ***.***.112.152_60008</div><div class="line">05:10:30 od_ping ***.***.112.152_60008</div><div class="line">05:11:37 od_ping ***.***.112.152_60008</div><div class="line">21:11:37 od_getById ***.***.112.152_60008</div><div class="line">21:11:49 od_listByParam ***.***.112.152_60008</div><div class="line">10:10:11 od_listByParam ***.***.112.152_60008</div><div class="line">11:11:31 od_listByParam ***.***.112.152_60008</div><div class="line">14:10:24 od_listByParam ***.***.112.152_60008</div><div class="line">14:11:34 od_getById ***.***.112.152_60008</div><div class="line">11:11:39 od_listByParam ***.***.112.152_60008</div><div class="line">13:11:39 od_listByParam ***.***.112.152_60008</div><div class="line">20:11:26 od_listByParam ***.***.112.152_60008</div><div class="line">21:11:33 od_listByPage ***.***.112.152_60008</div><div class="line">21:11:38 od_listByParam ***.***.112.152_60008</div><div class="line">10:11:43 od_listByParam ***.***.112.152_60008</div><div class="line">11:11:26 od_getById ***.***.112.152_60008</div><div class="line">14:11:36 od_getById ***.***.112.152_60008</div><div class="line">17:11:42 od_getById ***.***.112.152_60008</div><div class="line">11:10:10 od_listByParam ***.***.112.152_60008</div><div class="line">15:10:13 od_listByParam ***.***.112.152_60008</div><div class="line">19:11:26 od_listByParam ***.***.112.152_60008</div><div class="line">14:10:30 od_listByPage ***.***.112.152_60008 </div><div class="line">16:10:18 od_listByPage ***.***.112.152_60008</div><div class="line">20:10:30 od_listByParam ***.***.112.152_60008</div><div class="line">**@ubuntu:/data/log/ServiceAgent_d$</div></pre></td></tr></table></figure></p>
<p>左右端详,可以发现以下特点:具有周期性,而且集中在 152 机器上,都是每个小时的10分钟左右出现<br>
接下来查看机器运行情况:<br>
<img src="/img/20171020201157.jpg" alt=""><br>
可看到 CPU 也是有规律的升高.<br>
通过应用部署架构已知该主机上有定时任务 task 类型的应用,所以初步怀疑是某些 task 进程有问题</p>
<p>接下来进入该 152 机器,使用 <strong>top</strong> 命令观察 CPU,等待下一个周期,等到 11 分钟时,得到以下截图:
<img src="/img/20171020201826.jpg" alt="">
得知占用最大的程序为 gzip ,但是查不到 gzip 进行什么操作,无解<br>
另辟蹊径,咨询运维得知:每小时的第 10 分钟,logrotate 会对日志进行压缩轮转,如下图:
<img src="/img/20171020202253.jpg" alt=""><br>
所以定位的重点就变成:是否是某些日志设置不当,导致 logrotate 异常<br>
检查 logrotate 运行状态:<br>
<code>grep 10-20 /var/lib/logrotate/status</code><br>
<img src="/img/logrotatestatus.png" alt="">
检查 logrotate 操作的文件大小<br>
<code>grep 10-20 /var/lib/logrotate/status |awk -F '&quot;' '{print $2}'|xargs ls -alh</code><br>
<img src="/img/logrotatesfilesize.png" alt="">
倒数第二行,发现文件大小异常,检查日志文件所属程序,发现是遗留的 kafka 程序<br>
解决方案:
关闭它<br>
观察日志,没有发现超时,问题解决</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/11/20/fix_timeout_due_to_cpu_busy/" class="archive-article-date">
  	<time datetime="2017-11-20T12:55:01.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-11-20</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CPU/">CPU</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gzip/">gzip</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/logrotate/">logrotate</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-fix-sourcetree-authentication-failed" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/16/fix-sourcetree-authentication-failed/">记一次 SourceTree 错误</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>公司使用的 svn 服务器有限制，导致使用 SourceTree 一直获取不下来，因为无法在 SourceTree 中使用用户名密码进行认证，所以导致必须使用 <strong>git svn</strong> 先获取仓库到本地，然后再用 SourceTree 导入，但是导入后也同样会出现类似下面的错误：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">git -c diff.mnemonicprefix=false -c core.quotepath=false -c credential.helper=sourcetree svn fetch </div><div class="line">Authentication realm: &lt;https://192.168.1.251:8443&gt; VisualSVN Server</div><div class="line">Password for &apos;jinke.jiang&apos;: </div><div class="line">Authentication realm: &lt;https://192.168.1.251:8443&gt; VisualSVN Server</div><div class="line">Username: Use of uninitialized value in concatenation (.) or string at /Applications/SourceTree.app/Contents/Resources/git_local/lib/perl5/site_perl/Git/SVN/Prompt.pm line 20.</div><div class="line">Password for &apos;&apos;: </div><div class="line">Authentication realm: &lt;https://192.168.1.251:8443&gt; VisualSVN Server</div><div class="line">Username: Use of uninitialized value in concatenation (.) or string at /Applications/SourceTree.app/Contents/Resources/git_local/lib/perl5/site_perl/Git/SVN/Prompt.pm line 20.</div><div class="line">Password for &apos;&apos;: </div><div class="line">Can&apos;t create session: Unable to connect to a repository at URL &apos;https://192.168.1.251:8443/svn/jinguanjia_ios&apos;: No more credentials or we tried too many times.</div><div class="line">Authentication failed at /Applications/SourceTree.app/Contents/Resources/git_local/lib/perl5/site_perl/Git/SVN.pm line 143.</div></pre></td></tr></table></figure></p>
<p>原因是在使用 <strong>git svn</strong> 时输入的密码也没有进行保存，解决方法：</p>
<p>打开 <strong>～/.subversion/servers</strong> ,把最后的</p>
<pre><code>store-passwords = no
store-ssl-client-cert-pp = no
store-plaintext-passwords = no
store-ssl-client-cert-pp-plaintext = no
</code></pre>
<p>修改成：</p>
<pre><code>store-passwords = yes
store-ssl-client-cert-pp = yes
store-plaintext-passwords = yes
store-ssl-client-cert-pp-plaintext = yes

</code></pre>
<p>然后再使用  <strong>git svn</strong> 再操作一遍以保存账号密码</p>
<hr>
<p>参考链接：<a href="http://stackoverflow.com/questions/2599281/cant-make-svn-store-password-even-though-the-configuration-is-set-to-allow-it" target="_blank" rel="external">Can't make svn store password, even though the configuration is set to allow it</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/04/16/fix-sourcetree-authentication-failed/" class="archive-article-date">
  	<time datetime="2017-04-16T03:01:31.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-04-16</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SourceTree/">SourceTree</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Subversion/">Subversion</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git-svn/">git svn</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-installing-arch-linux" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/09/installing-arch-linux/">通过 U 盘驱动安装 Arch Linux</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天在一台老主机上安装了 Arch Linux，记录安装一下过程</p>
<h4>格式化 U 盘</h4>
<p>打开 Disk Utility 选择 U 盘点击 Erase，选择 MS-DOS(FAT),即格式为 FAT32 格式，点击确认，直到提示成功，点击 Unmount 按钮，取消挂载
<img src="/img/installing-arch-linux/QQ20170409-133222@2x.png" alt="">
<img src="/img/installing-arch-linux/QQ20170409-133313@2x.png" alt="">
<img src="/img/installing-arch-linux/QQ20170409-154534@2x.png" alt="">
<img src="/img/installing-arch-linux/QQ20170409-154709@2x.png" alt=""></p>
<h4>查看 U 盘盘符</h4>
<p>在 Terminal 下进行操作：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">$ diskutil list</div><div class="line">/dev/disk0 (internal, physical):</div><div class="line">   #:                       TYPE NAME                    SIZE       IDENTIFIER</div><div class="line">   0:      GUID_partition_scheme                        *251.0 GB   disk0</div><div class="line">   1:                        EFI EFI                     209.7 MB   disk0s1</div><div class="line">   2:          Apple_CoreStorage Macintosh HD            250.1 GB   disk0s2</div><div class="line">   3:                 Apple_Boot Recovery HD             650.1 MB   disk0s3</div><div class="line"></div><div class="line">/dev/disk1 (internal, virtual):</div><div class="line">   #:                       TYPE NAME                    SIZE       IDENTIFIER</div><div class="line">   0:                            Macintosh HD           +249.8 GB   disk1</div><div class="line">                                 Logical Volume on disk0s2</div><div class="line">                                 6EED22C6-6FD7-4444-AA83-A305369854DE</div><div class="line">                                 Unlocked Encrypted</div><div class="line"></div><div class="line">/dev/disk2 (external, physical):</div><div class="line">   #:                       TYPE NAME                    SIZE       IDENTIFIER</div><div class="line">   0:     FDisk_partition_scheme                        *8.0 GB     disk2</div><div class="line">   1:                 DOS_FAT_32 U                       8.0 GB     disk2s1</div></pre></td></tr></table></figure></p>
<p>根据容量判断哪个盘是 U 盘，这里为 /dev/disk2</p>
<h4>将下载的 iso 文件写入 U 盘</h4>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ sudo dd if=/Users/moon/Downloads/archlinux-2017.04.01-x86_64.iso of=/dev/rdisk2 bs=1m;sync</div><div class="line">Password:</div><div class="line">478+0 records in</div><div class="line">478+0 records out</div><div class="line">501219328 bytes transferred in 93.303333 secs (5371934 bytes/sec)</div></pre></td></tr></table></figure></p>
<p>此处注意在disk2 前加 <strong>r</strong>,等待结束，此时 U 盘已经处理完毕，插入需要安装的电脑进行安装，下面可以参考两个文档进行安装，一个是
<a href="https://wiki.archlinux.org/index.php/Installation_guide" target="_blank" rel="external">arch wiki</a>，一个是<a href="http://jingyan.baidu.com/article/59a015e3a9170ef7948865f3.html" target="_blank" rel="external">百度经验的文档</a></p>
<h4>开机选择 U 盘驱动，不同机器略有不同，我的机器是 F12 ,然后选中插入的 U 盘</h4>
<p>下面使用百度的图，因为我的安装时忘记截图了</p>
<p><img src="/img/installing-arch-linux/faf2b2119313b07e4a6e86260fd7912396dd8cc9.jpg" alt=""></p>
<h4>选择 Boot Arch Linux(x86-64) 或者 Boot Arch Linux(i686)，我只有 Boot Arch Linux(x86-64)一个选项</h4>
<p><img src="/img/installing-arch-linux/e61190ef76c6a7ef6b447908fefaaf51f3de66ba.jpg" alt=""></p>
<h4>进入命令行界面，先检测网络是否连接，安装时需要网络</h4>
<p>使用 <code>ping baidu.com</code> 进行测试，退出需要按 Ctrl+c 中断<br>
<img src="/img/installing-arch-linux/71cf3bc79f3df8dc08725cbfce11728b47102855.jpg" alt=""></p>
<h4>磁盘分区，格式化</h4>
<p>输入 <code>lsblk</code> 查看硬件设备，根据容量判断哪个是硬盘，一般都是 sda
<img src="/img/installing-arch-linux/d8f9d72a6059252dbe5ccc2a379b033b5bb5b951.jpg" alt=""></p>
<p>输入 <code>fdisk /dev/sda</code> 对硬盘进行分区， fdisk 的各种命令请输入 m 进行查看，一般是用 p 查看分区表情况，用 d 删除分区，n 新建分区，w 保存分区，保存后退出<br>
<img src="/img/installing-arch-linux/4ec2d5628535e5dd468d74f175c6a7efce1b627f.jpg" alt=""></p>
<p>回到 shell 界面后输入 <code>mkfs.ext4 /dev/sda1</code> 进行格式化，格式化为 ext4 文件格式<br>
<img src="/img/installing-arch-linux/4610b912c8fcc3ce21a0191d9145d688d43f20b8.jpg" alt=""></p>
<h4>挂载硬盘</h4>
<p>输入 <code>mount /dev/sda1 /mnt</code> 将分区挂载到 /mnt 上
<img src="/img/installing-arch-linux/5fdf8db1cb134954b19c384a554e9258d1094a1a.jpg" alt=""></p>
<h4>修改源</h4>
<p>按照 <a href="https://wiki.archlinux.org/index.php/Installation_guide" target="_blank" rel="external">arch wiki</a> 的步骤，现在就可以进行系统安装了，但是为了加速安装，我们需要把安装源修改成国内地址。<br>
步骤：输入 <code>vi /etc/pacman.d/mirrorslist</code> 打开文件<br>
在命令模式下输入 <code>/163</code> 回车查找 163 的源，它的位置在首屏的十几行的位置<br>
这时候输入 yy 进行复制，然后移动光标到第一行<br>
输入 p 进行粘贴，然后保存退出，修改源完毕<br>
再安装时就会优先取 163 源里的数据
<img src="/img/installing-arch-linux/a71ea8d3fd1f41345c4ed650261f95cad1c85ea7.jpg" alt=""></p>
<h4>安装</h4>
<p>输入 <code>pacstrap /mnt base</code><br>
<img src="/img/installing-arch-linux/3ac79f3df8dcd10060592b0f718b4710b8122fd3.jpg" alt=""></p>
<p>安装完毕后，输入 <code>arch-chroot /mnt</code>,可能需要再输入 <code>sh</code> 接入 sh 环境<br>
<img src="/img/installing-arch-linux/c8177f3e6709c93da461dcd99c3df8dcd1005409.jpg" alt=""></p>
<h4>安装 grub</h4>
<p>输入 <code>pacman -S grub</code><br>
<img src="/img/installing-arch-linux/c8177f3e6709c93da434dcd99c3df8dcd00054de.jpg" alt=""></p>
<h4>配置 grub</h4>
<p>输入 <code>grub-install /dev/sda</code><br>
<img src="/img/installing-arch-linux/2fdda3cc7cd98d108eb9d11f223fb80e7bec90ab.jpg" alt=""></p>
<h4>配置 boot 文件</h4>
<p>输入 <code>grub-mkconfig -o /boot/grub/grub.cfg</code><br>
<img src="/img/installing-arch-linux/d31b0ef41bd5ad6e36a5b9c482cb39dbb6fd3c44.jpg" alt=""></p>
<p>至此，全部操作完毕，输入 exit 退出，输入 reboot 重启</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/04/09/installing-arch-linux/" class="archive-article-date">
  	<time datetime="2017-04-09T04:03:12.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-04-09</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-abstain_weibo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/08/abstain_weibo/">如何摆脱对微博的依赖</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5>为什么要戒掉微博</h5>
<p>写代码时，如果注意力高度集中，这时候就容易出成果，但是如果走神的话很容易就磨洋工。<br>
造成走神的原因有很多，比如外部的原因：写代码时接到一个推销电话、同事过来请教一个问题等等，也有我们自身的原因，如：编译代码时无聊刷刷微博、看看 Q 群、逛逛淘宝。<br>
外部的干扰因素可以通过物理的方式来解决！比如带一个头戴式耳机，提高被骚扰的难度，但是自身的原因就控制不了啦～毕竟每天总有那么几个小时在 building，这时候如何克制住心理的魔鬼，不去看那些新鲜事呢？</p>
<p>网上也有类似的文章，一般的解决方法有这几种：</p>
<ol>
<li>找件事来替代微博，形成一种新的行为习惯。例如原本你晚上都闲着上网的，现在你每晚去游泳1小时，不带手机，回来后不急着开电脑，陪家人看会儿电视……然后刷会儿微博，尽量不留言和人做无营养的交流互动，批判性的审视自己关注的人的到底有多少讯息是对自己有益的，转变对微博的看法……</li>
<li>转跳注意力：调整关注人群，选择一些能有所长进和思考的人关注，及时在阅读过程中专跳出去，比如你看到某名博上关于某社会事件的争论，在稍微看浏览完相关信息和大众观点后，跳出来，拿纸笔或者在电脑上记录下你的所想和议论，（我这种笨人随便写点什么都会花掉大半个晚上的时间），或者是看到某人推荐一本书，你就隔日买来进行阅读，总之就是把微博作为一个讯息点，扩展其内容到别的主体上，具体因人而异；</li>
<li>如果你很难脱离微博，也可以用延迟的办法，将一日的内容分为几次来刷，强迫自己，只有下班回家路上才刷一次，追溯一下早上的内容，也不要三五分钟就叮当一下。</li>
</ol>
<p>但是还是避免不了每当 IDEA 编译时，不假思索地以迅雷不及掩耳之势点击 Chrome 图标，敲下 weibo.com 并回车...</p>
<h5>这时候，我们需要一种强制性措施</h5>
<p>打开终端，输入 <code>vim /etc/hosts</code>，打开 hosts 文件，在最下面添加一行<br>
<code>127.0.0.1 weibo.com</code><br>
这时候再不假思索地点击 Chrome 图标，敲下 weibo.com 并回车时，就会进入一个空白页了</p>
<p>全文完</p>
<h5>但是如果没有微博，我们自然会有新的消磨时间的工具，如 v2ex.com，reddit.com，因为总有那么几段时间是等待的</h5>
<p>不妨将我们的注意力引导到更加积极的地方去，比如说 <a href="http://e.xitu.io/" target="_blank" rel="external">稀土掘金</a>、<a href="http://segmentfault.com" target="_blank" rel="external">segmentfault</a><br>
说干就干：<br>
打开终端，先 <code>ping</code> 一下 e.xitu.io 的网站，得到 ip 为 207.226.141.170 ，然后
输入 <code>vim /etc/hosts</code>，打开 hosts 文件，在最下面添加一行<br>
<code>127.0.0.1 weibo.com</code><br>
修改完毕在访问 weibo.com，但是这个时候却不能出现我们希望看到的 e.xitu.io 的首页，看起来对方服务器反向代理时处理了，所以只能换另外一种方式<br>
--未完待续</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/01/08/abstain_weibo/" class="archive-article-date">
  	<time datetime="2017-01-08T12:31:21.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-01-08</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/">Nginx</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-20170101_2016-2017" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/01/20170101_2016-2017/">静宏的 2016 -&gt; 2017</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3>一.2016 总结</h3>
<p>一句话总结的话：&quot;一个 Java 工程师平静的一年&quot;<br>
从这句话可以隐隐约约闻出不好的气息，一个开发工程师如果觉得稳定，那么他应该考虑开始准备简历了，我觉得一份优秀的工作，应该是业务不断地促使技术的迭代，所以开发工程师注定闲不下来，促成技术的进步，2016 年工作一直很平稳，业务量并不大，导致一直在重复地 CRUD，所以我把精力放在了各种技术的拓展上，从 Spring 到 Spring boot，从各种 NoSql 数据库、缓存到各种消息队列，从 Dubbo 到 Spring Cloud，现在我已经学会如何利用 Github 进行有效地学习、工作<br>
先看一下 2014 到现在的计划:</p>
<ul>
<li><input type="checkbox" id="checkbox0"><label for="checkbox0"> 报考通过 系统分析师/系统结构师/PMP </label><strong>(每到报名时间都懒癌发作- -!)</strong></li>
<li><input type="checkbox" id="checkbox1" checked="true"><label for="checkbox1"> 学习实践GTD、时间管理。 </label><strong>(基本完成，下一步目标是把学习时间段移到早上)</strong></li>
<li><input type="checkbox" id="checkbox2" checked="true"><label for="checkbox2"> 养成记录习惯，实践印象笔记和tudo。 </label><strong>(基本完成，使用文本按日期+各种 checklist 记录)</strong></li>
<li><input type="checkbox" id="checkbox3" checked="true"><label for="checkbox3"> 继续多读书，每个月必须有一本到手，读完有思维导图总结 </label><strong>(基本完成，但是一般都没有记录)</strong></li>
<li><input type="checkbox" id="checkbox4"><label for="checkbox4"> 模仿主流的App，亲手做一个出来。 </label><strong>(懒癌发作- -!必须走出舒适区，读书学习就是我的舒适区，创造力硬伤)</strong></li>
<li><input type="checkbox" id="checkbox5" checked="true"><label for="checkbox5"> 买macbook pro，毕竟电脑是程序员的工具，买一个好点可以节省生命。 </label><strong>(写代码的人如果很少接触命令行说明他在划水，只热衷于命令行说明他是一个顽固派，热爱命令行，热爱图形化设计才是好程序员)</strong></li>
<li><input type="checkbox" id="checkbox6" checked="true"><label for="checkbox6"> 尝试从Eclipse转到Android Studio，毕竟很多开源项目都是在Android Studio上面了 </label><strong>(感谢	 JetBrains 从 Android Studio 到 IntelliJ IDEA，让我越来越热爱编程)</strong></li>
<li><input type="checkbox" id="checkbox7"><label for="checkbox7"> 把分散在各个角落的笔记收集起来，放在一个平台上，暂时存在 Github </label><strong>(完成一点点，笔记很少)</strong></li>
<li><input type="checkbox" id="checkbox8" checked="true"><label for="checkbox8"> 寻找自己感兴趣的项目，改进完善，折腾，这个估计会花费一些业余时间 </label><strong>(正在进行中)</strong></li>
<li><input type="checkbox" id="checkbox9"><label for="checkbox9"> 认识一些朋友，既要避开社交网络的淤泥，又要通过社交网络获取有用信息，还是比较有挑战性的 </label><strong>(时间协调注定无法平衡，得到什么就会失去什么，唯有让自身变得优秀才谈得上是有用的社交)</strong></li>
<li><input type="checkbox" id="checkbox10"><label for="checkbox10"> 健身，星期六早上 </label><strong>(正在进行中)</strong></li>
</ul>
<h4>成果</h4>
<ul>
<li>工作<br>
工作两年，有着过于熟练的手感，逐渐成长成为一名 CRUD 小能手，狂接需求的老司机，这时候应该有人开始会藐视技术了吧。所有顽固的老程序员都会有藐视技术的习惯，自认为已经洞察编程套路，自以为天下武功，無堅不破，唯快不破！天下编程都是同样的套路，熟悉一种就可以融会贯通。<br>
我还在读书的时候也会有这种想法，认为编程语言只是有不同的语法大全，现在看来这种心态是可悲的，和整天讨论这门语言好，或者那门语言坏的人一样，悲其一叶障目，更悲其大愚若智的自的心态。<br>
这一切都来源于眼界的不同，所以 2016 年，在工作中不断地进行试验，Redis、应用服务器集群、消息队列、CDN+负载均衡等等技术，这些事情必须要亲自做一遍才知道其中的坑与特性。<br>
上半年开始回顾 Java 后端栈的各种框架的使用：Spring、Spring boot、MyBatis、Lucene、Shiro等等，还弄了几个运维脚本，如：<a href="https://blog.acvrock.com/2016/04/04/server_monitor/" target="_blank" rel="external">shell 脚本定时监控日志报警</a> 、<a href="https://blog.acvrock.com/2016/04/04/log4j2_conf/" target="_blank" rel="external">log4j2 日志配置</a>、<a href="https://blog.acvrock.com/2016/04/07/cronolog/" target="_blank" rel="external">用 Cronolog 切割 Tomcat 的 catalina.out 日志</a>,现在看来都可以用 ELK 来做，相见恨晚呀！<br>
下半年开始回顾 Java 基础：Java 基础数据类型、集合框架、IO等等，其中发现有两个现象
<ol>
<li>如果学习过程中如果时间跨度过长，学习效果会减掉一大半，必须一蹴而就才有效果</li>
<li>如果学习过程没有进行记录，那么忘记的速度就是 O(n^2)</li>
</ol>
</li>
<li>学习<br>
今年下载的代码装满了我的 2T 硬盘，各种风格都有，有趣、猎奇、严谨、搞笑...<br>
下图是今年 Github 的记录,后边的提交是强行提交的，即使不写代码也写思路，逼迫自己不断地学习<br>
<img src="/img/QQ20161231@2x.png" alt=""><br>
读书方面除了线下一月一本的技术书，还有就是微信上的一些电子书，现在上下班路上的时间总共是两个小时，微信读书大部分时间都是这个时间段，唯一的缺点就是没有趁手可以总结的工具，导致一读而过，没有沉淀太多东西下来<br>
<img src="/img/IMG_3309.PNG" alt=""></li>
<li>生活<br>
时间协调注定无法平衡，得到什么就会失去什么，所以今年生活非常无味，没有太多激情的瞬间，毕业后就没有放松地出去旅行过，但是并不遗憾，因为独处能够带来大段的时间，用来深入地学习和思考。
<ol>
<li>虽然讨厌做饭，因为很浪费时间，但是也学会了一些菜</li>
<li>每天饭后散步是思考的时间，感谢 <a href="http://weibo.com/ofobike" target="_blank" rel="external">ofo 共享单车</a>，让我像秃鹰一样高效地探索公司周边的街头，这很有意义，让我对社会的感知摆脱来自电脑的依赖，通过阳光去看到生活，而不是通过微博、QQ 去和世界打交道</li>
<li>上半年的运动量还行，下半年就基本落下了，如果再不迅速扭转局面，二十几年来苗条的身体将面临着严重的威胁</li>
</ol>
</li>
</ul>
<h4>不足</h4>
<p>几年来未完成清单：</p>
<ul>
<li><input type="checkbox" id="checkbox11"><label for="checkbox11"> 报考通过 系统分析师/系统结构师/PMP</label></li>
<li><input type="checkbox" id="checkbox12"><label for="checkbox12"> 模仿主流的App，亲手做一个出来。</label></li>
<li><input type="checkbox" id="checkbox13"><label for="checkbox13"> 把分散在各个角落的笔记收集起来，放在一个平台上，暂时存在 Github，并发布在博客</label></li>
<li><input type="checkbox" id="checkbox14"><label for="checkbox14"> 认识一些朋友，既要避开社交网络的淤泥，又要通过社交网络获取有用信息，线下的渠道也行</label></li>
<li><input type="checkbox" id="checkbox15"><label for="checkbox15"> 健身，星期六早上</label></li>
</ul>
<h3>二.2017 展望</h3>
<ol>
<li>研究 Spring 源码，争取 2017 年 12 月份能够研究完：</li>
</ol>
<ul>
<li>容器实现</li>
<li>标签解析</li>
<li>bean 加载</li>
<li>AOP</li>
<li>JDBC</li>
<li>事务</li>
</ul>
<p>Keep Learning, Keep Thinking, Keep Practising, Keep Reflecting, Keep Examining, Keep Changing.</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/01/01/20170101_2016-2017/" class="archive-article-date">
  	<time datetime="2017-01-01T03:34:11.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-01-01</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/总结/">总结</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-java_byte" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/10/java_byte/">Java 中的基本数据类型</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Java 中数值类型的表示，byte 占用 8 个 bit ，每个 bit 只有 0 和 1 两个值，byte 的值在 bit 中表示就是二进制，所以值为 4 的 byte ，在计算机中表示为二进制的原码：<br>
00000100,如果是负数，则表示为负数正值的补码，如： -4 表示为：11111100，可以看出，如果首位为 1 时，表示负数，首位为 0 时，表示正数。所以 byte 的最大值和最小值分别是 127 、-127</p>
<ul>
<li>负数的二进制位表示过程如下：<br>
-4 取正值：<code>4</code><br>
正值转换为原码  <code>00000100</code><br>
原码取反为反码  <code>11111011</code><br>
反码+1变成补码   <code>11111100</code></li>
</ul>
<p>字符类型:char(16)<br>
布尔类型:boolean<br>
数值类型:byte(8)\short(16)\int(32)\long(64)\float(32)\double(64)</p>
<ul>
<li>位运算
左移:<code>&lt;&lt;</code> 丢弃最高位，0 补最低位，如果没有溢出，就是 n 次方<br>
右移:<code>&gt;&gt;</code> 符号位不变，左边补上符号位<br>
无符号位右移:<code>&gt;&gt;&gt;</code> 丢弃最低位，0 补最高位</li>
</ul>
<p>按位与、按位或、按位取反、按位异或</p>
<ol>
<li>网络通信、协议解析、高性能编程比较常见</li>
<li>位运算是针对整型的，进行位运算时，除了 long 类型外，其他类型会自动转为 int 型</li>
<li>如果移动的位数超过了 32 位（long是 64 位），那么编译器会对移动的位数取模，如对 int 型移动 33 位，实际上只移动了 33%32=1 位</li>
</ol>
<p>Java 包装类型内存大小比 基本类型大得多<br>
BigInteger\BigDecimal 表示大整数和大浮点数</p>
<ol>
<li>可以精确地表示大整数和小数</li>
<li>不可变性，不适合于大量的数学运算</li>
<li>如果需要精确计算，使用 String 构造 BigDecimal ，避免使用 double ，因为 doublle 本身就不准确了</li>
<li>equals 方法认为 0.1 和 0.1 是相等的，但是 0.10 和 0.1 是不等的。方法 compareTo 认为 0.1 和 0.1 相等， 0.10 和 0.1 是相等的，所以比较 BigDecimal 时，使用 compareTo()</li>
<li>有时候运算无法得到精确结果，产生无限循环小数，可以显式地控制舍入</li>
</ol>
<p>Java 数组是特殊的对象<br>
如何让对象数组缓存友好？</p>
<ul>
<li>程序启动是预先生成数组中引用的对象，增加缓存友好的概率<br>
For(...){
a[i] = new ObjectXX()
}</li>
<li>unsafe 控制 Java 对象内存位置</li>
<li>不使用对象</li>
</ul>
<p>java.util.Arrays 提供了 Java 数组排序方法，基本类型使用 DualPivotQuickSort 算法<br>
，Java 对象排序使用 TimSort 算法(JDK7),MergeSort（JDK6）</p>
<p>Java 数组高级技巧</p>
<ul>
<li>初始化数组: Arrays.setAll(array,generator);</li>
<li>高效复制数组: int[] arr = Arrays.copyof(源数组,新数组长度);</li>
<li>高效排序: Arrays.sort、并行排序 Arrays.parallelSort</li>
<li>高效查询: Arrays.binarySearch</li>
<li>输出内容为字符串: Arrays.toString(array)</li>
</ul>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/12/10/java_byte/" class="archive-article-date">
  	<time datetime="2016-12-10T13:44:10.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-12-10</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/读书笔记/">读书笔记</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-20161202_java_ collections" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/02/20161202_java_ collections/">Java 集合框架</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>Apache Common Collections</li>
<li>Google Guava</li>
<li>Java Collections Framework</li>
</ul>
<p>Collection
可遍历的、可伸缩的、可查询的，而可排序不是集合的要求<br>
Iterator 设计模式解决无限的数据-&gt; 有限的内存这个矛盾</p>
<p>PriorityQueue 优先队列，使用二叉堆实现,二叉堆又是用数组表示<br>
BlockingQueue 堵塞队列，用于生产者消费者模式<br>
HashMap 内部为一个 Tree 实现<br>
如果以插入+查找最小+删除最小来比较红黑树和最小堆时，红黑树占优<br>
JDK 8 中，HashMap Hash 冲突时，使用红黑树代替链表</p>
<p>java.lang.ref.SoftReference     软引用<br>
java.lang.ref.WeakReference     弱引用<br>
java.lang.ref.PhantomReference  虚引用<br>
WeakHashMap<br>
SkipList 跳表   ConcurrentSkipListMap  空间换时间<br>
树为了排序</p>
<h2>实践</h2>
<ul>
<li>定义时使用接口</li>
<li>底层返回集合为空时，返回长度为 0 的集合或者数组，不要返回 null</li>
<li>谨慎对待 hashCode 和 equals</li>
<li>用 Arrays 和 Collections 处理：排序、查找、集合类型转换、集合计算操作</li>
<li>如果元素长度固定，优先考虑 Array</li>
<li>使用泛型</li>
<li>遍历 List 时，考虑使用 ListIterator</li>
<li>频繁查找某个元素时，考虑进行排序</li>
<li>需要元素有序时，考虑使用 Linked 家族</li>
<li>使用 WeakHashMap 维护短暂使用的数据</li>
<li>多线程环境下优先使用 concurrent 家族</li>
<li>多线程环境下频繁遍历少量修改，考虑 CopyOnWriteArrayList</li>
<li>多线程环境下不要强一致性的遍历器，可考虑使用 ConcurrentHashahMap</li>
<li>多线程环境下使用 TreeMap ，考虑 ConcurrentSkipListSet 和 ConcurrentSkipListMap</li>
</ul>
<h2>QA</h2>
<p>1 分析Collection接口以及其子接口，很通俗的方式说说，究竟有哪些类型的Collection，各自解决什么样的问题
Collection 接口关系如图<br>
<img src="/img/QQ20161219-0@2x.png" alt=""><br>
三个子接口分别是: Queue、Set、List,还有一个抽象类 AbstractCollection,
Collection 接口抽象了一组元素的集合，提供了通用的集合操作方法
<img src="/img/QQ20161219-1@2x.png" alt=""></p>
<ul>
<li>其中 Set 代表无序，不可重复的集合，就像是一个盘子里的小石头，每个都一样是石头，但是每一个形状又都不一样，Set 的 API 和 Collection 完全一样;</li>
<li>List 代表有序，可重复的集合，List中的每一个元素都有一个索引；第一个元素的索引值是0，往后的元素的索引值依次+1，对比 Collection，List 拓展了自己的方法，增加了 “添加、删除、获取、修改指定位置的元素”、“获取List中的子队列” 等方法;<br>
<img src="/img/QQ20161220-0@2x.png" alt=""></li>
<li>Queue 代表一种队列集合，队列的头部保存在队列中存放时间最长的元素，尾部保存存放时间最短的元素。新元素插入到队列的尾部，取出元素会返回队列头部的元素，对比 Collection 接口，Queue 增加了&quot;队尾元素插入&quot;，&quot;获取队头元素&quot; 等方法
<img src="/img/QQ20161220-1@2x.png" alt=""></li>
<li>AbstractCollection 是一个抽象类，它实现了 Collection 中除 iterator() 和 size() 之外的函数。
AbstractCollection 的主要作用：它实现了 Collection 接口中的大部分函数。从而方便其它类实现Collection，比如ArrayList、LinkedList等，它们这些类想要实现Collection接口，通过继承AbstractCollection就已经实现了大部分的接口了。</li>
</ul>
<p>2 TreeSet继承了什么Set，与HashSet的区别是？HashSet与HashTable是“一脉相承”的么？
TreeSet 和 HashSet 类图如下:
<img src="/img/set.png" alt="">
可以看到，TreeSet 和 HashSet 都继承了 AbstractSet，都实现了 Serializable、Cloneable 接口，但是对于 HashSet 来说，TreeSet 实现了 NavigableSet、SortedSet 接口
SortedSet 具有排序功能，它支持对 Set 中的元素排序，提供了三大功能，分别是</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"> public interface SortedSet&lt;E&gt; extends Set&lt;E&gt; &#123;</div><div class="line">    // Range-view 范围查看 </div><div class="line">    SortedSet&lt;E&gt; subSet(E fromElement, E toElement);</div><div class="line">    SortedSet&lt;E&gt; headSet(E toElement);</div><div class="line">    SortedSet&lt;E&gt; tailSet(E fromElement);</div><div class="line"></div><div class="line">    // Endpoints  端点</div><div class="line">    E first();</div><div class="line">    E last();</div><div class="line"></div><div class="line">    // Comparator access  访问 Comparator</div><div class="line">    Comparator&lt;? super E&gt; comparator();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>NavigableSet  直译成中文就是：可导航的 Set,是 SortedSet 的子接口，有 ConcurrentSkipListSet, TreeSet 两种实现<br>
增加了返回小于（lower）、小于等于（floor）、大于等于（ceiling）和大于（higher）输入参数的一个元素的方法<br>
弹出第一个(pollFirst)，最后一个元素(pollLast)、<br>
以及正向和逆向的迭代器、<br>
返回更小的元素集合(headSet)，更大的元素集合(tailSet)，区间元素集合(subSet)
<img src="/img/QQ20161223-0@2x.png" alt=""></p>
<p>HashSet与HashTable 不是是“一脉相承”的，因为 HashSet 实现了 Set 接口，HashTable 实现了 Map 接口</p>
<p>3 Queue接口增加了哪些方法，这些方法的作用和区别是？<br>
Queue 本质上是一个操作受限的集合，结构图如下：<br>
<img src="/img/QQ20161223-2@2x.png" alt=""></p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">offer       添加一个元素并返回插入结果,优于add，因为如果队列已满，则返回false，不抛出异常  </div><div class="line">remove   	 移除并返回队列头部的元素， 如果队列为空，则抛出一个异常   </div><div class="line">poll        移除并返问队列头部的元素，优于remove,因为如果队列为空，则返回null   </div><div class="line">element     返回队列头部的元素，如果队列为空，则抛出一个异常      </div><div class="line">peek        返回队列头部的元素，优于peek,因为如果队列为空，则返回null</div></pre></td></tr></table></figure></p>
<p>4 LinkedList也是一种Queue么？是否是双向链表?<br>
LinkedList 实现了 Queue 接口，所以可以作为队列，作为 FIFO 的队列时，下表的方法等价：</p>
<table>
<thead>
<tr>
<th>队列方法</th>
<th>等效方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>add(e)</td>
<td>addLast(e)</td>
</tr>
<tr>
<td>offer(e)</td>
<td>offerLast(e)</td>
</tr>
<tr>
<td>remove()</td>
<td>removeFirst()</td>
</tr>
<tr>
<td>poll()</td>
<td>pollFirst()</td>
</tr>
<tr>
<td>element()</td>
<td>getFirst()</td>
</tr>
<tr>
<td>peek()</td>
<td>peekFirst()</td>
</tr>
</tbody>
</table>
<p>LinkedList 是双向链表实现，从下图可以看出，它分别记录了头节点和尾节点，便于双向遍历<br>
<img src="/img/QQ20161224-0@2x.png" alt=""><br>
5 Java数组如何与Collection相互转换</p>
<ul>
<li>Collection to Array:</li>
</ul>
<ol>
<li>Bar[] result = foos.stream().map(Bar::new).toArray(Bar[]::new);</li>
<li>Foo[] foos = x.toArray(new Foo[x.size()]);</li>
<li>int i = 0;<br>
Bar[] bars = new Bar[fooCollection.size()];
for( Foo foo : fooCollection ) { // where fooCollection is Collection&lt;Foo&gt; bars[i++] = new Bar(foo);
}</li>
</ol>
<ul>
<li>Array to Collection:</li>
</ul>
<ol>
<li>XXX xxx = new XXX(Arrays.asList(array));</li>
<li>Collections.addAll(list, array);</li>
<li>XXX xxx = Arrays.stream(array).collect(Collectors.toXXX());</li>
</ol>
<p>6 Map的一级子接口有哪些种类，分别用作什么目的？<br>
下图为 Map 实现类和子接口
<img src="/img/QQ20161224-3@2x.png" alt=""><br>
子接口有：<br>
Bindings,      不明
ConcurrentMap&lt;K,V&gt;,   定义了几个基于 CAS（Compare and Set）操作
MessageContext,   不明<br>
ObservableMap,   允许注册观察者跟踪 Map 值的更改<br>
SortedMap&lt;K,V&gt;    可进行排序的 Map<br>
XSNamedMap,      为内部使用的接口，不明<br>
7 HashSet 与HashMap中放入的自定义对象必须要实现哪些方法，说明原因<br>
如果要将自定义的对象放入到HashMap或HashSet中，需要@Override hashCode()和equals()方法。hashCode()方法决定了对象会被放到哪个bucket里，当多个对象的哈希值冲突时，equals()方法决定了这些对象是否是“同一个对象”。<br>
8 TreeSet里的自定义对象必须要实现什么方法，说明原因<br>
因为 TreeSet 具有排序功能，所以对象集合必须实现Comparable接口,并重写compareTo()方法，通常我们需要保持 compareTo 和 equals 同步，所以最好也实现 equalse 方法<br>
9 LinkedHashMap使用什么来保存数据，其效率与HashMap相比如何？它又有什么独特特性<br>
LinkedHashMap 继承了 HashMap ，所以底层使用了数组来保存数据，用 set 来保存 key 集合，但是它又新增了 head 和 tail 实现双向循环链表，下面是开销情况：
<img src="/img/9Ete5.jpg" alt=""><br>
对比 HashMap Hash的无序性，LinkedHashMap 的元素可以按插入顺序或访问顺序排列</p>
<p>10 IdentityHashMap 里面如果按照下面的方法放入对象，分别是什么结果，请解释原因</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> Integer a=5;</div><div class="line"> Integer b=5;</div><div class="line"> map.put(a,&quot;100&quot;);</div><div class="line"> map.put(b,&quot;100&quot;;</div><div class="line"> System.out.println(map.size);</div><div class="line"> map.clear();</div><div class="line">Integer a=Integer.MAX_VALUE-1;</div><div class="line">Integer b=Integer.MAX_VALUE-1;</div><div class="line">map.put(a,&quot;100&quot;);</div><div class="line"> map.put(b,&quot;100&quot;;</div><div class="line"> System.out.println(map.size);</div></pre></td></tr></table></figure></p>
<p>结果如图:
<img src="/img/QQ20161224-1@2x.png" alt=""><br>
原因是：是 IdentityHashMap 使用的是==比较key的值，调用 Integer.valueOf, 当值小于 127 时，返回的都是 IntegerCache 的值，所以 IdentityHashMap 认为它是同一个 key ，128 开始就返回一个新的 Integer, IdentityHashMap就认为不相等了</p>
<p>加分题，
给出ＪＤＫ　１.８的java 集合框架全图谱（Class类图）， 并标明1.7与1.8里出现的新的类，解释其目的<br>
下图为集合框架（非并发）
<img src="/img/collection.png" alt=""></p>
<ul>
<li>
<p>Iterator。它是遍历集合的工具，我们经常使用Iterator迭代器来遍历集合。Collection的实现类都要实现iterator()函数，返回一个Iterator对象。</p>
</li>
<li>
<p>Collection是一个interface<br>
Collection有List、Set和Queue三大分支。</p>
<ul>
<li>
<p>List&lt;E&gt;是一个队列，根据下标索引，第一个元素的下标是0，List的实现类有LinkedList, ArrayList, Vector, Stack。List是有序的队列，List中可以有重复的值。</p>
</li>
<li>
<p>Set&lt;E&gt;是一个集合，SET中的值是唯一的，我们经常会遇到List去重的问题，把List转为SET就可以快速实现 Set的实现类有HastSet和TreeSet。HashSet。其中TreeSet是有序的。</p>
</li>
<li>
<p>Queue 代表一种队列集合，队列的头部保存在队列中存放时间最长的元素，尾部保存存放时间最短的元素。新元素插入到队列的尾部，取出元素会返回队列头部的元素</p>
</li>
</ul>
</li>
<li>
<p>Map&lt;K,V&gt;是一个interface，即key-value键值对。Map中的每一个元素包含“一个key”和“key对应的value”。</p>
<ul>
<li>AbstractMap是个抽象类，它实现了Map接口中的大部分API。而HashMap，TreeMap，WeakHashMap都是继承于AbstractMap。</li>
</ul>
</li>
<li>
<p>抽象类AbstractCollection、AbstractList、AbstractSet、AbstractMap是抽象类，他们都实现了各自的大部分方法，我们直接继承Abstract类就可以省去重复编码相同的方法</p>
</li>
<li>
<p>List简介</p>
</li>
</ul>
<ol>
<li>List 是一个接口，它继承于Collection的接口。它代表着有序的队列。</li>
<li>AbstractList 是一个抽象类，它继承于AbstractCollection。AbstractList实现List接口中除size()、get(int location)之外的函数。</li>
<li>AbstractSequentialList 是一个抽象类，它继承于AbstractList。AbstractSequentialList 实现了“链表中，根据index索引值操作链表的全部函数”。</li>
<li>ArrayList, LinkedList, Vector, Stack, 是List的4个实现类,RandomAccessSubList是内部类。</li>
</ol>
<ul>
<li>Map体系</li>
</ul>
<ol>
<li>Map 是映射接口，Map中存储的内容是键值对(key-value)。</li>
<li>AbstractMap 是继承于Map的抽象类，它实现了Map中的大部分API。其它Map的实现类可以通过继承AbstractMap来减少重复编码。</li>
<li>SortedMap 是继承于Map的接口。SortedMap中的内容是排序的键值对，排序的方法是通过比较器(Comparator)。</li>
<li>NavigableMap 是继承于SortedMap的接口。相比于SortedMap，NavigableMap有一系列的导航方法；如&quot;获取大于/等于某对象的键值对&quot;、“获取小于/等于某对象的键值对”等等。</li>
<li>TreeMap 继承于AbstractMap，且实现了NavigableMap接口；因此，TreeMap中的内容是“有序的键值对”， 它是通过红黑树实现的。它一般用于单线程中存储有序的映射。</li>
<li>HashMap 继承于AbstractMap，没实现SortedMap或NavigableMap接口；因此，HashMap的内容是无序的键值对。</li>
<li>LinkedHashMap 继承于HashMap，LinkedHashMap 的元素可以按插入顺序或访问顺序排列</li>
<li>IdentityHashMap 是 1.4 版本新增的一种特殊的HashMap，还是用key的hashCode来决定entry的槽位，但是不用key的equals方法来决定是否相等了，而是默认使用地址（即使实现了equals，equals也不起作用）来决定是否相等</li>
<li>EnumMap 是 1.5 版本新增的一种键为枚举类型的特殊的Map实现。所有的Key也必须是一种枚举类型，EnumMap是使用数组来实现的。</li>
<li>Hashtable继承于Dictionary(Dictionary也是键值对的接口)，实现Map接口；因此，Hashtable的内容也是“键值对，是无序的”。 Hashtable是线程安全的。</li>
<li>WeakHashMap 继承于AbstractMap。它和HashMap的键类型不同，WeakHashMap的键是“弱键”， 当“弱键”被GC回收时，它对应的键值对也会被从WeakHashMap中删除。JVM提供的弱引用</li>
</ol>
<ul>
<li>Set简介</li>
</ul>
<ol>
<li>Set 是继承于Collection的接口。它是一个不允许有重复元素的集AbstractSet 是一个抽象类，它继承于AbstractCollection，AbstractCollection实现了Set中的绝大部分函数，为Set的实现类提供了便利。</li>
<li>HashSet 和 TreeSet 是Set的两个实现类。HashSet中的元素是无序的。TreeSet中的元素是有序的，不支持快速随机遍历，只能通过迭代器进行遍历。</li>
<li>LinkedHashSet继承于 HashSet ,它以元素插入的顺序来维护集合的链接表，允许以插入的顺序在集合中迭代；</li>
<li>EnumSet 是 enum 值的集合。在 Java 中，每个 enum 都映射至一个 int 类型：每个 enum 值映射的 int 都互不相同。这使得 BitSet 之类的集合结构成为可能，每个 bit 都映射到一个不同的 enum 值。此类还存在两种实现——包含单个 long 类型（可存储64个 enum 值，足够覆盖99.9%的用例）的 RegularEnumSet 与包含 long[] 类型的 JumboEnumSet</li>
</ol>
<ul>
<li>Queues(队列)/deques(双队列)</li>
</ul>
<ol>
<li>AbstractQueue 是继承于Queue的抽象类，它实现了Queue中的大部分API。其它Queue的实现类可以通过继承AbstractQueue来减少重复编码</li>
<li>PriorityQueue 继承 AbstractQueue ，是一个基于优先级堆的极大优先级队列。</li>
<li>ArrayDeque 基于数组的双端队列</li>
</ol>
<p>并发的集合有点乱...</p>
<p><a href="http://www.cnblogs.com/skywang12345/p/3308513.html#a4" target="_blank" rel="external">Java 集合系列02之 Collection架构</a><br>
<a href="http://www.importnew.com/19892.html" target="_blank" rel="external">Java HashSet和HashMap源码剖析</a><br>
<a href="http://stackoverflow.com/questions/2889777/difference-between-hashmap-linkedhashmap-and-treemap" target="_blank" rel="external">Difference between HashMap, LinkedHashMap and TreeMap</a><br>
<a href="https://my.oschina.net/oneapmofficial/blog/673984" target="_blank" rel="external">Java 性能调优指南之 Java 集合概览</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/12/02/20161202_java_ collections/" class="archive-article-date">
  	<time datetime="2016-12-02T15:04:30.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-12-02</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/读书笔记/">读书笔记</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-20161201_java_io" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/01/20161201_java_io/">Java IO 编码解码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>ASCII 数字 0-9 对应的 byte 值为 48-57<br>
Unicode 与 Java<br>
char 是字符数据类型，是无符号的，占2字节，大小范围是 0-65535，是 16 位二进制的 Unicode 字符，Java 用 char 来表示一个字符<br>
大部分中文使用三个字节的 UTF-8 方法编码</p>
<p>IO 传输的两个关键问题：</p>
<ol>
<li>Encode/Decode</li>
<li>Big Endian/Little Endian</li>
</ol>
<p>二进制方式读取文件</p>
<ul>
<li>ByteArrayOutputStream: 可以捕获内存缓冲区的数据，转换成字节数组</li>
<li>ByteArrayInputStream: 可以将字节数组转化为输入流</li>
</ul>
<ul>
<li>字符串的编码/解码问题<br>
charset</li>
<li>多字节数据（short/int/long/double/float）的编码/解码问题<br>
ObjectOutputStream  （默认 Big-Endian 顺序）</li>
<li>Object 对象编码/解码问题<br>
Java Serialize 机制（二进制）以及 java.beans 包里面的 XMLEncoder (文本编码)</li>
</ul>
<h3>Java Object 序列化机制</h3>
<ul>
<li>当父类实现了序列化，子类也自动实现了序列化，不需要显式实现 Serializable 接口</li>
<li>反过来一个子类实现了 Serializable 接口，希望父类对象序列化，需要父类也实现Serializable 接口，否则父类对象的成员变量不参与序列化</li>
<li>当一个对象的实例变量引用其他对象，序列化该对象时，也会把引用对象也进行序列化</li>
<li>某些对象不能序列化，如：安全问题不能远程传输的对象、无法重新还原的对象（socket、thread、Stream）</li>
</ul>
<p>RandomAccessFile==&gt;MappedByteBuffer<br>
MappedByteBuffer:内存映射文件
MapMode 映射模式:</p>
<ul>
<li>READ_ONLY 只读映射模式</li>
<li>READ_WRITE 读写映射模式</li>
<li>PRIVATE   通过 put 方法对 MappedByteBuffer 的修改不会修改到磁盘文件，只修改虚拟内存的修改</li>
</ul>
<p>MappedByteBuffer 在父类 ByteBuffer  的基础上新增了几个方法</p>
<ol>
<li>fore 缓冲区在   READ_WRITE 模式下，此方法对缓冲区所做的内容更改强制写入文件</li>
<li>load 将缓冲区的内容载入物理内存，并返回该缓冲区的引用</li>
<li>isLoaded 判断缓冲区的内容是否在物理内存，如果在就返回 true，否则返回 false</li>
</ol>
<p>Java IO 中应用到了装饰者模式</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/12/01/20161201_java_io/" class="archive-article-date">
  	<time datetime="2016-12-01T14:08:30.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-12-01</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/读书笔记/">读书笔记</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-the_pragmatic_programmer" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/26/the_pragmatic_programmer/">程序员修炼之道</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Don't Live with Broken Windows<br>
Be a Catalyst for Change<br>
Remember the Big Picture<br>
Make Quality a Requirements Issue<br>
Invest Regularly in Your Knowledge Portfolio</p>
<ul>
<li>每年至少学习一种新语言</li>
<li>每季度阅读一本技术书籍</li>
<li>也要阅读非技术书籍</li>
<li>上课</li>
<li>参加本地用户组织</li>
<li>实验不同的环境</li>
<li>跟上潮流</li>
<li>上网</li>
</ul>
<p>Critically Analyze What You Read and Hear<br>
WISDOM 离合诗</p>
<ul>
<li>你想让他们学到什么？</li>
<li>他们对你讲的什么感兴趣？</li>
<li>他们有多富有经验？</li>
<li>他们想要什么细节？</li>
<li>你先要让谁拥有这些信息？</li>
</ul>
<p>It's Both What You Say and the Way You Say It</p>
<p>DRY - Don't Repeat Yourself<br>
重复是如何发生的</p>
<ul>
<li>强加的重复</li>
<li>无意的重复</li>
<li>无耐性的重复</li>
<li>开发者之间的重复</li>
</ul>
<p>把低级的知识放在代码中，把注释保留给其他的高级说明</p>
<p>Make it Easy to Reuse<br>
Eliminate Effects Between Unrelated Things<br>
There Are No Final Decisions<br>
Use Tracer Bullets to Find the Target</p>
<ul>
<li>用户能够及早看到能工作的东西</li>
<li>开发者构建里一个它们能在其中工作的结构</li>
<li>你有了一个集成平台</li>
<li>你有了可用于演示的东西</li>
<li>你见更能够感受到工作进度</li>
</ul>
<p>语言的界限就是一个人的世界的界限<br>
Program Close to the Problem domain<br>
Estimate to Avoid Surprises</p>
<table>
<thead>
<tr>
<th>时长</th>
<th>报出估算的单位</th>
</tr>
</thead>
<tbody>
<tr>
<td>1～15 天</td>
<td>天</td>
</tr>
<tr>
<td>3～8 周</td>
<td>周</td>
</tr>
<tr>
<td>8～30 周</td>
<td>月</td>
</tr>
<tr>
<td>30+ 周</td>
<td>在给出估算前努力思考一下</td>
</tr>
</tbody>
</table>
<p>Iterate the Schedule with the Code<br>
Keep Knowledge in Plain Text<br>
Use the Power of Command Shells<br>
Use a Single Editor Well<br>
Always Use Source Code Control<br>
Fix the Problem,Not the Blame<br>
Don't Panic<br>
&quot;Select&quot; Isn't Broken<br>
Don't Assume it - Prove It<br>
Learn a Text Manipulation Language<br>
Write Code That Writes Code<br>
You Can't Write Perfect Software<br>
Design with Contracts<br>
Crash Early<br>
If it Can't Happen,Use Assertions to Ensure That it Won't<br>
Use Exceptions for Exceptional Problems<br>
Finish What You Start<br>
Minimize Coupling Between Modules<br>
Configure,Don't Integrate<br>
Put Abstractions in Code,Details in Metadata<br>
Analyze Workflow to Improve Concurrency<br>
Design Using Services<br>
Always Design for Concurrency<br>
Separate Views from Models<br>
Use Blackboards to Coordinate Workflow<br>
Don't Program by Coincidence</p>
<p>怎样深思熟虑地编程</p>
<ul>
<li>总是意识到你在做什么</li>
<li>不要盲目地编程</li>
<li>按照计划行事</li>
<li>依靠可靠的事物</li>
<li>为你的假定建立文档</li>
<li>不要只是测试你的代码，还要测试你的假定</li>
<li>为你的工作划分优先级</li>
<li>不要做历史的奴隶</li>
</ul>
<p>Estimate the Order of Your Algorithms<br>
Test Your Estimates<br>
Refactor  Early,Refactor Often<br>
Design to Test<br>
Test Your Software,or Your Users Will<br>
Don't Use Wizard Code You Don't Understand<br>
完美，不是在没有什么需要增加，而在没有什么需要去掉时达到的<br>
Don't Gather Requirements  - Dig for Them<br>
Work with a User to Think Like a User<br>
Abstractions Live Longer than Details<br>
Use a Project Glossary<br>
Don't Think Outside the Box - Find the Box<br>
Listen to Nagging Doubts - Start When You're Ready<br>
Some Things Are Better Done than Described<br>
Don't Be a Slave to Format Methods<br>
Expensive Tools Do Not Produce Better Designs<br>
Organize Around Functionality,Not Job Functions<br>
Test Early. Test Often. Test Automatically.<br>
Coding Ain't Done Til All the Tests Run<br>
Use Saboteurs to Test Your Testing<br>
Find Bugs Once<br>
Treat English as Just Another Programming Language<br>
Build Documentation In,Don't Bolt It On<br>
Gently Exceed Your Users' Expectaions<br>
Sign Your Work</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/11/26/the_pragmatic_programmer/" class="archive-article-date">
  	<time datetime="2016-11-26T15:01:43.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-11-26</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/读书笔记/">读书笔记</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-fix_springaop_nosuchmethoderror" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/16/fix_springaop_nosuchmethoderror/">记一次 java.lang.NoSuchMethodError 错误</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天在使用 EnableScheduling 测试计划任务时，出现了以下错误：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">WARNING: Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name &apos;scheduledTaskService&apos; defined in file [/Users/moon/spring/target/classes/taskscheduler/ScheduledTaskService.class]: Initialization of bean failed; nested exception is java.lang.NoSuchMethodError: org.springframework.aop.support.AopUtils.selectInvocableMethod(Ljava/lang/reflect/Method;Ljava/lang/Class;)Ljava/lang/reflect/Method;</div><div class="line">Exception in thread &quot;main&quot; org.springframework.beans.factory.BeanCreationException: Error creating bean with name &apos;scheduledTaskService&apos; defined in file [/Users/moon/spring/target/classes/taskscheduler/ScheduledTaskService.class]: Initialization of bean failed; nested exception is java.lang.NoSuchMethodError: org.springframework.aop.support.AopUtils.selectInvocableMethod(Ljava/lang/reflect/Method;Ljava/lang/Class;)Ljava/lang/reflect/Method;</div><div class="line">	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:553)</div><div class="line">	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:482)</div><div class="line">	at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:306)</div><div class="line">	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:230)</div><div class="line">	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:302)</div><div class="line">	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197)</div><div class="line">	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:751)</div><div class="line">	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:861)</div><div class="line">	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:541)</div><div class="line">	at org.springframework.context.annotation.AnnotationConfigApplicationContext.&lt;init&gt;(AnnotationConfigApplicationContext.java:84)</div><div class="line">	at taskscheduler.Main.main(Main.java:12)</div><div class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</div><div class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</div><div class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</div><div class="line">	at java.lang.reflect.Method.invoke(Method.java:497)</div><div class="line">	at com.intellij.rt.execution.application.AppMain.main(AppMain.java:147)</div><div class="line">Caused by: java.lang.NoSuchMethodError: org.springframework.aop.support.AopUtils.selectInvocableMethod(Ljava/lang/reflect/Method;Ljava/lang/Class;)Ljava/lang/reflect/Method;</div><div class="line">	at org.springframework.scheduling.annotation.ScheduledAnnotationBeanPostProcessor.processScheduled(ScheduledAnnotationBeanPostProcessor.java:300)</div><div class="line">	at org.springframework.scheduling.annotation.ScheduledAnnotationBeanPostProcessor.postProcessAfterInitialization(ScheduledAnnotationBeanPostProcessor.java:283)</div><div class="line">	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsAfterInitialization(AbstractAutowireCapableBeanFactory.java:422)</div><div class="line">	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1588)</div><div class="line">	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:545)</div><div class="line">	... 15 more</div></pre></td></tr></table></figure></p>
<p>经过排查后发现是 <code>spring-context</code> 和 <code>spring-aop</code> 版本不兼容导致</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</div><div class="line">        &lt;version&gt;4.3.3.RELEASE&lt;/version&gt;</div><div class="line">    &lt;/dependency&gt;</div><div class="line"></div><div class="line">    &lt;!--spring aop--&gt;</div><div class="line">    &lt;dependency&gt;</div><div class="line">        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">        &lt;artifactId&gt;spring-aop&lt;/artifactId&gt;</div><div class="line">        &lt;version&gt;4.2.7.RELEASE&lt;/version&gt;</div><div class="line">    &lt;/dependency&gt;</div></pre></td></tr></table></figure></p>
<p>更换 <code>spring-context</code> 和 <code>spring-aop</code> 版本即可解决</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">           &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">           &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</div><div class="line">           &lt;version&gt;4.3.3.RELEASE&lt;/version&gt;</div><div class="line">       &lt;/dependency&gt;</div><div class="line"></div><div class="line">       &lt;!--spring aop--&gt;</div><div class="line">       &lt;dependency&gt;</div><div class="line">           &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">           &lt;artifactId&gt;spring-aop&lt;/artifactId&gt;</div><div class="line">           &lt;version&gt;4.3.3.RELEASE&lt;/version&gt;</div><div class="line">       &lt;/dependency&gt;</div></pre></td></tr></table></figure></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/10/16/fix_springaop_nosuchmethoderror/" class="archive-article-date">
  	<time datetime="2016-10-16T07:24:01.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-10-16</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Error/">Error</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/">Spring</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-redis_auto-start_on_linux" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/28/redis_auto-start_on_linux/">在 Linux 下配置 Redis 开机启动</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3>在 Linux 下配置 Redis 开机启动，主要步骤如下：</h3>
<ol>
<li>设置 Redis redis.conf 文件，使之能够以后台模式运行</li>
<li>编写 shell 启动 Redis 脚本</li>
<li>配置 Linux 开机启动配置</li>
</ol>
<h3>实际操作：</h3>
<ul>
<li>打开 redis.conf 文件，修改：<code>#daemonize yes</code>为<code>daemonize yes</code></li>
<li>编写 shell 脚本，输入<code>vim /etc/init.d/redis</code><br>
下面有两段代码任选一段都可以使用，都是 Centos 可用的启动 Redis 脚本,其中的文件位置需要根据实际情况修改</li>
</ul>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"># chkconfig: 2345 10 90</div><div class="line"># description: Start and Stop redis</div><div class="line"></div><div class="line">PATH=/usr/local/bin:/sbin:/usr/bin:/bin</div><div class="line"></div><div class="line">REDISPORT=6379 #实际环境而定</div><div class="line">EXEC=/usr/local/redis/src/redis-server #实际环境而定</div><div class="line">REDIS_CLI=/usr/local/redis/src/redis-cli #实际环境而定</div><div class="line"></div><div class="line">PIDFILE=/var/run/redis.pid</div><div class="line">CONF=&quot;/usr/local/redis/redis.conf&quot; #实际环境而定</div><div class="line"></div><div class="line">case &quot;$1&quot; in</div><div class="line">        start)</div><div class="line">                if [ -f $PIDFILE ]</div><div class="line">                then</div><div class="line">                        echo &quot;$PIDFILE exists, process is already running or crashed.&quot;</div><div class="line">                else</div><div class="line">                        echo &quot;Starting Redis server...&quot;</div><div class="line">                        $EXEC $CONF</div><div class="line">                fi</div><div class="line">                if [ &quot;$?&quot;=&quot;0&quot; ]</div><div class="line">                then</div><div class="line">                        echo &quot;Redis is running...&quot;</div><div class="line">                fi</div><div class="line">                ;;</div><div class="line">        stop)</div><div class="line">                if [ ! -f $PIDFILE ]</div><div class="line">                then</div><div class="line">                        echo &quot;$PIDFILE exists, process is not running.&quot;</div><div class="line">                else</div><div class="line">                        PID=$(cat $PIDFILE)</div><div class="line">                        echo &quot;Stopping...&quot;</div><div class="line">                        $REDIS_CLI -p $REDISPORT SHUTDOWN</div><div class="line">                        while [ -x $PIDFILE ]</div><div class="line">                        do</div><div class="line">                                echo &quot;Waiting for Redis to shutdown...&quot;</div><div class="line">                                sleep 1</div><div class="line">                        done</div><div class="line">                        echo &quot;Redis stopped&quot;</div><div class="line">                fi</div><div class="line">                ;;</div><div class="line">        restart|force-reload)</div><div class="line">                $&#123;0&#125; stop</div><div class="line">                $&#123;0&#125; start</div><div class="line">                ;;</div><div class="line">        *)</div><div class="line">                echo &quot;Usage: /etc/init.d/redis &#123;start|stop|restart|force-reload&#125;&quot; &gt;&amp;2</div><div class="line">                exit 1</div><div class="line">esac</div></pre></td></tr></table></figure></p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line">#!/bin/sh</div><div class="line">#chkconfig: 345 86 14</div><div class="line">#description: Startup and shutdown script for Redis</div><div class="line"> </div><div class="line">PROGDIR=/usr/local/bin</div><div class="line">PROGNAME=redis-server</div><div class="line">DAEMON=$PROGDIR/$PROGNAME</div><div class="line">CONFIG=/etc/redis.conf</div><div class="line">PIDFILE=/var/run/redis.pid</div><div class="line">DESC=&quot;redis daemon&quot;</div><div class="line">SCRIPTNAME=/etc/init.d/redis</div><div class="line"> </div><div class="line">start()</div><div class="line">&#123;</div><div class="line">         if test -x $DAEMON</div><div class="line">         then</div><div class="line">        echo -e &quot;Starting $DESC: $PROGNAME&quot;</div><div class="line">                   if $DAEMON $CONFIG</div><div class="line">                   then</div><div class="line">                            echo -e &quot;OK&quot;</div><div class="line">                   else</div><div class="line">                            echo -e &quot;failed&quot;</div><div class="line">                   fi</div><div class="line">         else</div><div class="line">                   echo -e &quot;Couldn&apos;t find Redis Server ($DAEMON)&quot;</div><div class="line">         fi</div><div class="line">&#125;</div><div class="line"> </div><div class="line">stop()</div><div class="line">&#123;</div><div class="line">         if test -e $PIDFILE</div><div class="line">         then</div><div class="line">                   echo -e &quot;Stopping $DESC: $PROGNAME&quot;</div><div class="line">                   if kill `cat $PIDFILE`</div><div class="line">                   then</div><div class="line">                            echo -e &quot;OK&quot;</div><div class="line">                   else</div><div class="line">                            echo -e &quot;failed&quot;</div><div class="line">                   fi</div><div class="line">         else</div><div class="line">                   echo -e &quot;No Redis Server ($DAEMON) running&quot;</div><div class="line">         fi</div><div class="line">&#125;</div><div class="line"> </div><div class="line">restart()</div><div class="line">&#123;</div><div class="line">    echo -e &quot;Restarting $DESC: $PROGNAME&quot;</div><div class="line">    stop</div><div class="line">         start</div><div class="line">&#125;</div><div class="line"> </div><div class="line">list()</div><div class="line">&#123;</div><div class="line">         ps aux | grep $PROGNAME</div><div class="line">&#125;</div><div class="line"> </div><div class="line">case $1 in</div><div class="line">         start)</div><div class="line">                   start</div><div class="line">        ;;</div><div class="line">         stop)</div><div class="line">        stop</div><div class="line">        ;;</div><div class="line">         restart)</div><div class="line">        restart</div><div class="line">        ;;</div><div class="line">         list)</div><div class="line">        list</div><div class="line">        ;;</div><div class="line"> </div><div class="line">         *)</div><div class="line">        echo &quot;Usage: $SCRIPTNAME &#123;start|stop|restart|list&#125;&quot; &gt;&amp;2</div><div class="line">        exit 1</div><div class="line">        ;;</div><div class="line">esac</div><div class="line">exit 0</div></pre></td></tr></table></figure></p>
<ul>
<li>为 shell 启动 Redis 脚本添加执行权限：<code>chmod +x /etc/init.d/redis</code></li>
<li>测试脚本是否可用，可执行 <code>service redis start</code> 进行启动，启动后可连接 Redis 进行测试</li>
<li>如果脚本可用，即可将其配置为开机启动项，执行<code>chkconfig redis on</code>即可，设置后可使用<code>chkconfig --list</code>查看是否有 redis 选项，到此，完成配置流程结束</li>
<li>这时候，可能在开机时仍然无法自动启动 Redis ，这是因为开机执行启动脚本 /etc/init.d/redis ，是没有输入参数的，所以都会走到脚本中的 <code>*)</code> 这里，所以此时需要修改上面的脚本，如第二个脚本，修改</li>
</ul>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">*)</div><div class="line">       echo &quot;Usage: $SCRIPTNAME &#123;start|stop|restart|list&#125;&quot; &gt;&amp;2</div><div class="line">       exit 1</div><div class="line">       ;;</div></pre></td></tr></table></figure></p>
<p>为</p>
<pre><code> *)
 start
 ;;
</code></pre>
<h3>参考</h3>
<p><a href="http://my.oschina.net/indestiny/blog/197272" target="_blank" rel="external">Centos开机自启动redis</a><br>
<a href="https://gist.github.com/ddkangfu/afbc8adf7a17fb71cfc4" target="_blank" rel="external">ddkangfu/redis开机启动脚本</a><br>
<a href="http://www.cnblogs.com/dkblog/archive/2012/05/15/2501885.html" target="_blank" rel="external">init.d里chkconfig（linux启动脚本讲解+示例）</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/08/28/redis_auto-start_on_linux/" class="archive-article-date">
  	<time datetime="2016-08-28T15:58:13.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-08-28</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Centos/">Centos</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redis/">Redis</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-jvm_gc_opt" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/10/jvm_gc_opt/">HotSpot VM 相关参数</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1>HotSpot VM 相关参数</h1>
<p>&lt;!--
create time: 2016-06-10 13:46:04
Author: &lt;TODO: 请写上你的名字&gt;</p>
<p>This file is created by Marboo<a href="http://marboo.io" target="_blank" rel="external">http://marboo.io</a> template file $MARBOO_HOME/.media/starts/default.md
本文件由 Marboo<a href="http://marboo.io" target="_blank" rel="external">http://marboo.io</a> 模板文件 $MARBOO_HOME/.media/starts/default.md 创建
--&gt;</p>
<p>##HotSpot VM 关于GC日志相关的命令行选项</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-XX:+PrintGCTimeStamps -XX:+PrintGCDetails -Xloggc:&lt;filename&gt;</div></pre></td></tr></table></figure></p>
<p>生成文件格式：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2.660: [GC [PSYoungGen: 142835K-&gt;10734K(142848K)] 144991K-&gt;26629K(317440K), 0.0203930 secs] [Times: user=0.05 sys=0.02, real=0.02 secs] </div><div class="line">86.592: [Full GC [PSYoungGen: 3456K-&gt;0K(1329664K)] [ParOldGen: 153539K-&gt;90508K(212480K)] 156995K-&gt;90508K(1542144K) [PSPermGen: 67518K-&gt;67135K(220160K)], 0.4519800 secs] [Times: user=1.54 sys=0.03, real=0.45 secs]</div></pre></td></tr></table></figure></p>
<ul>
<li><strong>2.660</strong> 是从 JVM 启动直到垃圾收集发生所经历的时间</li>
<li><strong>GC</strong> 代表是一次 Minor GC</li>
<li><strong>Full GC</strong> 代表一次 Full GC</li>
<li><strong>[PSYoungGen: 142835K-&gt;10734K(142848K)]</strong> 的 PSYoungGen 表示使用了多线程垃圾收集器 Parallel Scavenge，其它的收集器还有：多线程 ParNew 、单线程 ParNew、G1。
箭头（-&gt;）左边是回收前新生代占用空间，右边代表回收后占用的空间，Ps：Minor GC 回收后 Eden 空间为空，所以回收后的空间可以视为 Surivor 占用空间，括号里代表新生代的总大小</li>
<li><strong>144991K-&gt;26629K(317440K)</strong> 代表垃圾收集后 Java 堆堆使用情况（包括新生代和老年代），箭头（-&gt;）左边是回收前 Java 堆占用空间，右边代表回收后占用的空间，括号里代表 Java 堆的总大小 ,Ps:根据 Java 堆总大小和新生代总大小，可以推算出老年代占用空间</li>
<li><strong>0.0203930 secs</strong> 代表垃圾收集过程所消耗的时长</li>
<li><strong>[Times: user=0.05 sys=0.02, real=0.02 secs]</strong> 提供了 CPU和时间消耗情况。user 是用户态的消耗时间，即运行于 JVM 中的时间。</li>
</ul>
<p>如果想使用日历时间打印时间戳，可以使用 <strong>-XX:PrintGCDateStamps</strong> 替换 <strong>-XX:+PrintGCTimeStamps`</strong>
生成文件格式将会变成：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2016-06-10T15:29:34.899-0800: 19.409: [GC [PSYoungGen: 1291624K-&gt;16960K(1337344K)] 1396481K-&gt;131948K(1511936K), 0.0174330 secs] [Times: user=0.09 sys=0.02, real=0.02 secs]</div></pre></td></tr></table></figure></p>
<h2>设置内存空间</h2>
<ul>
<li>-Xmx 指定了新生代和老年代空间（Java 堆）大小的最大值</li>
<li>-Xms 指定了新生代和老年代空间（Java 堆）大小的初始值和最小值</li>
<li>关注吞吐量及延迟的 Java 应用应该将 -Xmx 和 －Xms 设置为同一值，避免 Java 堆伸缩带来的 Full GC</li>
<li>-XX:NewSize=&lt;n&gt;[g|m|k] 新生代空间大小的初始值和最小值，必须和-XX:MaxNewSize配合使用</li>
<li>-XX:MaxNewSize=&lt;n&gt;[g|m|k] 新生代空间大小的最大值，必须和-XX:NewSize配合使用</li>
<li>-Xmn&lt;n&gt;[g|m|k] 一次性设置新生代空间的初始值、最小值、最大值，如果设置了该值，新生代大小会恒定，所以只有 -Xmx 和 －Xms 设置为同一值时才使用 -Xmn 选项</li>
<li>老年代空间会根据 Java 堆空间和新生代空间隐性设定，最大为：-Xmx  减去  -XX:NewSize，最小为-Xmx 减去 -XX:MaxNewSize</li>
<li>-XX:PermSize=&lt;n&gt;[g|m|k] 永久代空间初始值和最小值</li>
<li>-XX:MaxPermSize=&lt;n&gt;[g|m|k] 永久代空间的最大值</li>
<li>关注性能的 Java 应用应该将 -XX:PermSize 和 -XX:MaxPermSize 设置为同一值，避免永久堆大小调整带来的 Full GC</li>
<li>如果不显式设置 Java 堆大小，JVM 会根据系统自动选择合适的值</li>
<li>JVM 内存调节的计算法则：</li>
</ul>
<table>
<thead>
<tr>
<th>空间</th>
<th>命令行选项</th>
<th>占用倍数</th>
</tr>
</thead>
<tbody>
<tr>
<td>Java 堆</td>
<td>-Xms 和 -Xmx</td>
<td>3～4 倍 Full GC 后的老年代空间占用量</td>
</tr>
<tr>
<td>永久代</td>
<td>-XX:PermSize 和 -XX:MaxPermSize</td>
<td>1.2～1.5 倍 Full GC 后的永久代空间占用量</td>
</tr>
<tr>
<td>新生代</td>
<td>-Xmn</td>
<td>1～1.5 倍 Full GC 后的老年代空间占用量</td>
</tr>
<tr>
<td>老年代</td>
<td>Java 堆大小减新生代大小</td>
<td>2～3 倍 Full GC 后老年代空间占用量</td>
</tr>
</tbody>
</table>
<ul>
<li>调节新生代空间准则:
<ul>
<li>老年代空间大小不应该小于活跃数据大小的 1.5 倍</li>
<li>新生代空间至少应为 Java 堆 大小的 10％</li>
<li>增大 Java 堆大小时，不能超过 JVM 可用的物理内存数</li>
</ul>
</li>
</ul>
<h2>设置收集器</h2>
<ul>
<li>-XX:+UseParallelOldGC 指定使用 Throughput 收集器</li>
<li>-XX:+UseConcM
来源于 Java 性能优化权威指南 第七章</li>
</ul>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/06/10/jvm_gc_opt/" class="archive-article-date">
  	<time datetime="2016-06-10T09:31:24.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-06-10</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JVM/">JVM</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/读书笔记/">读书笔记</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-infinity_and_nan" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/02/infinity_and_nan/">Java 中的无穷和非数</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Java 中的正无穷（POSITIVE_INFINITY）负无穷（NEGATIVE_INFINITY）和非数（NaN）</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1.0f / 0.0f = Infinity   </div><div class="line">-1.0f / 0.0f = -Infinity   </div><div class="line">0.0f / 0.0f = NaN</div></pre></td></tr></table></figure></p>
<p>来源于 java.lang.Float 的源码</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/05/02/infinity_and_nan/" class="archive-article-date">
  	<time datetime="2016-05-02T09:58:13.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-05-02</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-cronolog" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/07/cronolog/">用 Cronolog 切割 Tomcat 的 catalina.out 日志</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1>用 Cronolog 切割 Tomcat 的 catalina.out 日志</h1>
<p>Cronolog 是一个小巧高效的日志文件处理工具，可以实现自动的按规则生成周期性的日志文件<br>
安装 cronolog 命令如下：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">wget ftp://de.aminet.net/macports/distfiles/cronolog-devel/cronolog-1.7.0-beta.tar.gz</div><div class="line">tar zxvf cronolog-1.7.0-beta.tar.gz</div><div class="line">cd cronolog-1.7.0</div><div class="line">./configure</div><div class="line">make install</div><div class="line">which cronolog</div></pre></td></tr></table></figure></p>
<p>也可使用 yum 进行安装<br>
设置 catalina.out 位置,修改 catalina.sh：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># Add on extra jar files to CLASSPATH</div><div class="line">if [ ! -z &quot;$CLASSPATH&quot; ] ; then</div><div class="line">  CLASSPATH=&quot;$CLASSPATH&quot;:</div><div class="line">fi</div><div class="line">CLASSPATH=&quot;$CLASSPATH&quot;&quot;$CATALINA_HOME&quot;/bin/bootstrap.jar</div><div class="line">if [ -z &quot;$CATALINA_OUT&quot; ] ; then</div><div class="line">  CATALINA_OUT=&quot;$CATALINA_BASE&quot;/logs/catalina.out</div><div class="line">fi</div></pre></td></tr></table></figure></p>
<p>为：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># Add on extra jar files to CLASSPATH</div><div class="line">if [ ! -z &quot;$CLASSPATH&quot; ] ; then</div><div class="line">  CLASSPATH=&quot;$CLASSPATH&quot;:</div><div class="line">fi</div><div class="line">CLASSPATH=&quot;$CLASSPATH&quot;&quot;$CATALINA_HOME&quot;/bin/bootstrap.jar</div><div class="line">if [ -z &quot;$CATALINA_OUT&quot; ] ; then</div><div class="line">  CATALINA_OUT=/mnt/logs/%Y-%m-%d.out</div><div class="line">fi</div></pre></td></tr></table></figure></p>
<p>配置 cronolog 切割日志，修改 catalina.sh</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">org.apache.catalina.startup.Bootstrap &quot;$@&quot; start \</div><div class="line">    &gt;&gt; &quot;$CATALINA_OUT&quot; 2&gt;&amp;1 &quot;&amp;&quot;</div></pre></td></tr></table></figure></p>
<p>为：</p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">   org.apache.catalina.startup.Bootstrap &quot;$@&quot; start 2&gt;&amp;1 \</div><div class="line">| /usr/sbin/cronolog &quot;$CATALINA_OUT&quot; &gt;&gt; /dev/null &amp;</div></pre></td></tr></table></figure></p>
<p>（有两处地方需要修改），此处的 /usr/sbin/cronolog 可以通过<code>which cronolog</code>查看，配置完毕启动 Tomcat 生效</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/04/07/cronolog/" class="archive-article-date">
  	<time datetime="2016-04-07T14:45:28.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-04-07</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cronolog/">Cronolog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Log/">Log</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/">Tomcat</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-log4j2_conf" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/04/log4j2_conf/">log4j2 日志配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1>log4j2 日志配置</h1>
<p>目前用到 log4j2 的配置，如果想使用 Asynchronous Loggers 的话需要导入 disruptor-3.0.0 或者更高版本</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;GBK&quot;?&gt;
&lt;!-- status=&quot;OFF&quot;，可以去掉，它的含义为是否记录 log4j2 本身的 event 信息，默认是 OFF --&gt;
&lt;configuration status=&quot;OFF&quot;&gt;
&lt;!-- 定义下面的引用名 --&gt;
&lt;Properties&gt;
    &lt;property name=&quot;log_pattern&quot;&gt;%d{yyyy-MM-dd HH:mm:ss z} %-5level %class{36}%L%M - %msg%xEx%n&lt;/property&gt;
    &lt;property name=&quot;log-path&quot;&gt;/logs/app&lt;/property&gt;&lt;!--${sys:user.home} 是 home 目录、 ${web:rootDir} 是项目根目录 --&gt;
    &lt;property name=&quot;every_file_size&quot;&gt;50M&lt;/property&gt;&lt;!-- 日志切割的最小单位 --&gt;
    &lt;property name=&quot;output_log_level&quot;&gt;debug&lt;/property&gt;&lt;!-- 日志输出级别 --&gt;
&lt;/Properties&gt;

&lt;!--先定义所有的 appender --&gt;
&lt;appenders&gt;

    &lt;!--这个输出控制台的配置 --&gt;
    &lt;Console name=&quot;Console&quot; target=&quot;SYSTEM_OUT&quot;&gt;
        &lt;!--控制台只输出 level 及以上级别的信息（onMatch），其他的直接拒绝（onMismatch） --&gt;
        &lt;ThresholdFilter level=&quot;trace&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot; /&gt;
        &lt;!--输出日志的格式 --&gt;
        &lt;PatternLayout pattern=&quot;${log_pattern}&quot; /&gt;
    &lt;/Console&gt;

    &lt;!-- debug 级别日志文件 --&gt;
    &lt;!--每次大小超过 size，则这 size 大小的日志会自动进行压缩，作为存档 --&gt;
    &lt;RollingRandomAccessFile name=&quot;app_debug&quot; fileName=&quot;${log-path}/debug/debug.log&quot; filePattern=&quot;${log-path}/debug/debug-%d{yyyy-MM-dd}-%i.log.gz&quot; immediateFlush=&quot;false&quot;&gt;
        &lt;Filters&gt;
            &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;DENY&quot; onMismatch=&quot;NEUTRAL&quot; /&gt;
            &lt;ThresholdFilter level=&quot;debug&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;NEUTRAL&quot; /&gt;
        &lt;/Filters&gt;
        &lt;PatternLayout pattern=&quot;${log_pattern}&quot; /&gt;
        &lt;SizeBasedTriggeringPolicy size=&quot;${every_file_size}&quot;/&gt;
    &lt;/RollingRandomAccessFile&gt;

    &lt;!-- info 级别日志文件 --&gt;
    &lt;RollingRandomAccessFile name=&quot;app_info&quot; fileName=&quot;${log-path}/info/info.log&quot; filePattern=&quot;${log-path}/info/info-%d{yyyy-MM-dd}-%i.log.gz&quot; immediateFlush=&quot;false&quot;&gt;
        &lt;Filters&gt;
            &lt;ThresholdFilter level=&quot;warn&quot; onMatch=&quot;DENY&quot; onMismatch=&quot;NEUTRAL&quot; /&gt;
            &lt;ThresholdFilter level=&quot;info&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot; /&gt;
        &lt;/Filters&gt;
        &lt;PatternLayout pattern=&quot;${log_pattern}&quot; /&gt;
        &lt;SizeBasedTriggeringPolicy size=&quot;${every_file_size}&quot;/&gt;
    &lt;/RollingRandomAccessFile&gt;

    &lt;!-- error 级别日志文件 --&gt;
    &lt;RollingRandomAccessFile name=&quot;app_error&quot; fileName=&quot;${log-path}/error/error.log&quot; filePattern=&quot;${log-path}/error/error-%d{yyyy-MM-dd}-%i.log.gz&quot; immediateFlush=&quot;false&quot;&gt;
        &lt;Filters&gt;
            &lt;ThresholdFilter level=&quot;warn&quot; onMatch=&quot;ACCEPT&quot; onMismatch=&quot;DENY&quot; /&gt;
        &lt;/Filters&gt;
        &lt;PatternLayout pattern=&quot;${log_pattern}&quot; /&gt;
        &lt;SizeBasedTriggeringPolicy size=&quot;${every_file_size}&quot;/&gt;
    &lt;/RollingRandomAccessFile&gt;

&lt;/appenders&gt;

&lt;Loggers&gt;
    &lt;!--&lt;AsyncLogger name=&quot;org.springframework&quot; level=&quot;error&quot; additivity=&quot;false&quot; includeLocation=&quot;true&quot;&gt;--&gt;
        &lt;!--&lt;appender-ref ref=&quot;Console&quot; /&gt;--&gt;
        &lt;!--&lt;appender-ref ref=&quot;app_debug&quot;/&gt;--&gt;
        &lt;!--&lt;appender-ref ref=&quot;app_info&quot;/&gt;--&gt;
        &lt;!--&lt;appender-ref ref=&quot;app_error&quot;/&gt;--&gt;
    &lt;!--&lt;/AsyncLogger&gt;--&gt;

    &lt;!--打印程序自身的日志--&gt;
    &lt;AsyncLogger name=&quot;com.abc&quot; level=&quot;trace&quot; additivity=&quot;false&quot; includeLocation=&quot;true&quot;&gt;
        &lt;appender-ref ref=&quot;Console&quot; /&gt;
        &lt;appender-ref ref=&quot;app_debug&quot;/&gt;
        &lt;appender-ref ref=&quot;app_info&quot;/&gt;
        &lt;appender-ref ref=&quot;app_error&quot;/&gt;
    &lt;/AsyncLogger&gt;
    &lt;!--上面过滤完毕后,接下来的 log 就由 ROOT 进行管理--&gt;
    &lt;Root level=&quot;error&quot;&gt;
        &lt;appender-ref ref=&quot;Console&quot; /&gt;
        &lt;appender-ref ref=&quot;app_debug&quot;/&gt;
        &lt;appender-ref ref=&quot;app_info&quot;/&gt;
        &lt;appender-ref ref=&quot;app_error&quot;/&gt;
    &lt;/Root&gt;
&lt;/Loggers&gt;
</code></pre>
<p>&lt;/configuration&gt;</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/04/04/log4j2_conf/" class="archive-article-date">
  	<time datetime="2016-04-04T08:01:04.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-04-04</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/log4j2/">log4j2</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-server_monitor" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/04/server_monitor/">shell脚本定时监控日志报警</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1>shell脚本定时监控日志报警</h1>
<p>最近遇到一个需求，需要监控服务器错误日志的情况，以便及时发现服务器异常，在网上找了一圈后发现了这一篇文章，<a href="http://www.wiggins.top/wordpress/?p=277" target="_blank" rel="external">shell脚本定时监控日志报警</a>
，经过修改后符合我们项目的要求，主要修改了获取日志文件列表的方式，使它支持多目录监控，使用时需要配置好 /etc/mail.rc 使之可发送邮件，再结合 Crontab 即可实现定时监控：<br>
原程序：<a href="https://github.com/Acvrock/shell/blob/master/monitor.sh" target="_blank" rel="external">monitor.sh</a></p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"></div><div class="line">#记录上一次的行数</div><div class="line">Last_num_d=/tmp/monitor/lastnum</div><div class="line">#日志目录</div><div class="line">Log_directory=/usr/local/nginx/logs</div><div class="line">#ERROR log 临时存放目录</div><div class="line">Error_log=/tmp/monitor/errorlog</div><div class="line"></div><div class="line">#目录判断</div><div class="line">d_judge()&#123;</div><div class="line"> [ ! -d $1 ] &amp;&amp; mkdir -p $1</div><div class="line">&#125;</div><div class="line"></div><div class="line">d_judge $Last_num_d</div><div class="line">d_judge $Error_log</div><div class="line"></div><div class="line"></div><div class="line">for logfile in `ls $Log_directory |grep log |grep -v access` ; do</div><div class="line">#for logfile in `ls $Log_directory` ; do</div><div class="line">    #先判断当前日志目录是否为空，为空则直接跳过</div><div class="line">    [ ! -s $Log_directory/$logfile ] &amp;&amp; echo &quot;`date` $logfile is empty&quot; &amp;&amp; continue</div><div class="line">    #判断记录上一次检查的行数的文件是否存在，不存在则给一个初始值</div><div class="line">    [ ! -f &quot;$Last_num_d/$logfile&quot; ] &amp;&amp; echo 1 &gt; $Last_num_d/$logfile</div><div class="line">    #将上一次值赋给变量</div><div class="line">    last_count=`cat $Last_num_d/$logfile`</div><div class="line">    #将当前的行数值赋给变量</div><div class="line">    current_count=`grep -Fc &quot;&quot; $Log_directory/$logfile`</div><div class="line">    #判断当前行数跟上一次行数是否相等，相等则退出当前循环</div><div class="line">    [ $last_count -eq $current_count ] &amp;&amp; echo &quot;`date` $logfile no change&quot; &amp;&amp; continue</div><div class="line">    #由于日志文件每天都会截断，因此会出现当前行数小于上一次行数的情况，此种情况出现则将上一次行数置1</div><div class="line">    [ $last_count -gt $current_count ] &amp;&amp; last_count=1</div><div class="line">    #截取上一次检查到的行数至当前行数的日志并检索出有ERROR的日志，并重定向到相应的ERROR日志文件</div><div class="line">    sed -n &quot;$last_count,$current_count p&quot; $Log_directory/$logfile | grep -i ERROR &gt;&gt; $Error_log/$logfile &amp;&amp; echo &quot;`date` $logfile error &quot; || echo &quot;`date` $logfile changed but no error&quot;</div><div class="line">    #判断ERROR日志是否存在且不为空，不为空则说明有错误日志，继而发送报警信息，报警完成后删除错误日志</div><div class="line">    [ -s $Error_log/$logfile ] &amp;&amp; echo -e &quot;$HOSTNAME \n `cat $Error_log/$logfile`&quot; | mail -s &quot;$logfile ERROR&quot; xxxxxxx@qq.com  &amp;&amp; rm -rf $Error_log/$logfile</div><div class="line">    #结束本次操作之后把当前的行号作为下一次检索的last number</div><div class="line">    echo $current_count &gt; $Last_num_d/$logfile</div><div class="line">done</div></pre></td></tr></table></figure></p>
<p>修改后：<a href="https://github.com/Acvrock/shell/blob/master/monitor_md.sh" target="_blank" rel="external">monitor_md.sh</a></p>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"></div><div class="line">#记录上一次的行数</div><div class="line">Last_num_d=/tmp/monitor/lastnum</div><div class="line">#日志目录 可以是某目录如：Log_directory=/root/test，或者是多个目录，用空格隔开Log_directory=“/root/test /root/test1”</div><div class="line">Log_directorys=&quot;/mnt/harddrive/logs/app1/error /mnt/harddrive/logs/app2/error /mnt/harddrive/logs/app3/error&quot;</div><div class="line">#ERROR log 临时存放目录</div><div class="line">Error_log=/tmp/monitor/errorlog</div><div class="line"></div><div class="line">#目录判断</div><div class="line">d_judge()&#123;</div><div class="line">    [ ! -d $1 ] &amp;&amp; mkdir -p $1</div><div class="line">&#125;</div><div class="line"></div><div class="line">d_judge $Last_num_d</div><div class="line">d_judge $Error_log</div><div class="line">for Log_directory in  $Log_directorys ;do</div><div class="line">    # 所有日志log文件，除了带 access 的文件，此处的 awk 作用为查出全路径</div><div class="line">    for logfile in `ls -1 $Log_directory  |awk &apos;&#123;print i$0&#125;&apos; i=$Log_directory&apos;/&apos;  |grep log |grep -v access` ; do</div><div class="line">        #for logfile in `ls $Log_directory |grep log |grep -v access` ; do # 这是查出路径</div><div class="line">        #for logfile in `ls $Log_directory` ; do</div><div class="line">        # 文件名称不能带斜杠/,所以把文件名转换成不带斜杠的</div><div class="line">        logfilemarkfile=`echo $logfile |awk &apos;&#123;gsub(&quot;/&quot;,&quot;-&quot;) ; print $0&#125;&apos;`</div><div class="line">        #先判断当前日志目录是否为空，为空则直接跳过</div><div class="line">        [ ! -s $logfile ] &amp;&amp; echo &quot;`date` $logfile is empty&quot; &amp;&amp; continue</div><div class="line">        #判断记录上一次检查的行数的文件是否存在，不存在则给一个初始值</div><div class="line">        [ ! -f &quot;$Last_num_d/$logfilemarkfile&quot; ] &amp;&amp; echo 1 &gt; $Last_num_d/$logfilemarkfile</div><div class="line">        #将上一次值赋给变量</div><div class="line">        last_count=`cat $Last_num_d/$logfilemarkfile`</div><div class="line">        #将当前的行数值赋给变量</div><div class="line">        current_count=`grep -Fc &quot;&quot; $logfile`</div><div class="line">        #判断当前行数跟上一次行数是否相等，相等则退出当前循环</div><div class="line">        [ $last_count -eq $current_count ] &amp;&amp; echo &quot;`date` $logfile no change&quot; &amp;&amp; continue</div><div class="line">        #由于日志文件每天都会截断，因此会出现当前行数小于上一次行数的情况，此种情况出现则将上一次行数置1</div><div class="line">        [ $last_count -gt $current_count ] &amp;&amp; last_count=1</div><div class="line">        #截取上一次检查到的行数至当前行数的日志并检索出有ERROR的日志，并重定向到相应的ERROR日志文件</div><div class="line">        sed -n &quot;$last_count,$current_count p&quot; $logfile | grep -i ERROR &gt;&gt; $Error_log/$logfilemarkfile &amp;&amp; echo &quot;`date` $logfile error &quot; || echo &quot;`date` $logfile changed but no error&quot;</div><div class="line">        #判断ERROR日志是否存在且不为空，不为空则说明有错误日志，继而发送报警信息，报警完成后删除错误日志</div><div class="line">        [ -s $Error_log/$logfilemarkfile ] &amp;&amp; echo -e &quot;$HOSTNAME \n `cat $Error_log/$logfilemarkfile`&quot; | mail -s &quot;$logfile ERROR&quot; xxxxxxx@qq.com  &amp;&amp; rm -rf $Error_log/$logfilemarkfile</div><div class="line">        #结束本次操作之后把当前的行号作为下一次检索的last number</div><div class="line">        echo $current_count &gt; $Last_num_d/$logfilemarkfile</div><div class="line">    done</div><div class="line">done</div></pre></td></tr></table></figure></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/04/04/server_monitor/" class="archive-article-date">
  	<time datetime="2016-04-03T16:50:58.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-04-04</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Shell/">Shell</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-20150201_2015-2016" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/01/20150201_2015-2016/">静宏的 2015 -&gt; 2016</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2>#2015 -&gt; 2016</h2>
<h3>一.2015 总结</h3>
<p>2015 年经历了挺多事：公司融资、公司倒闭、毕业、跳槽、再跳槽，工作也从一个纯安卓开发变成 Java 后台开发，自我感觉其实是不太好，至少没有达到最好的状态，主要的缺陷还是时间无法充分利用，学习效率较低。<br>
2015 年初，所处的那家公司拿到了一点融资，然后在年中倒闭，在这家公司一年多的时间里，见证了一个项目的萌芽，发展，挣扎，消亡。真是百般滋味。按照我现在看到的东西肯定写不出什么总结经验，唯有领悟到一点：只有不断努力的做事情和学习，才能在不断变换的局势中应付自如<br>
2015 年初还只是一个入门级安卓开发者，工作生活全部是安卓世界，但是工作需要，在比较短的时间里就强行转成了 Java 后台开发，初步涉及三大框架等等技术。这个情况让一个初级程序员很是迷茫，初学者在技术上的追求究竟是先广度再深度，还是先有深度再广度，这个问题我偏向于先从某方面的深度入手，再追求广度，所以在接下来的跳槽中，我的工作意向还是安卓开发，但是职场的风云变幻，总是出乎我的意料，在人生的第二家公司中，我以移动开发工程师的身份入职，但是期间做了大半个月的 Node.js，后来在我离职的时候，我已经是一名 Java 后台开发，半年时间又重新跳回 Java 开发，真有恍如隔世的感觉，所以在后来的一段时间，我恶补了 Java 开发的一些基础，看了各大框架和设计模式，把半路出家的坑补上，在 2015 年末的时候，自我评价应该能算是初级 Java 开发了，再反过来看安卓，感觉在设计和实现上， J2ee 和 Android 还有很多相通的地方，一些技术难点的理解反而比以前更清晰了</p>
<h4>成果</h4>
<ol>
<li>在工作时带领过一段时间的技术团队，效果自我评价比较一般，但是也有收获，促使我看了几本团队管理和项目管理的书</li>
<li>在技术上 2015 年接触的面比较大，从 Android、iOS 到 Node.js、html5 再到 Java web，各种框架、工具都有所运用，体会到各种技术之间的异同</li>
<li>毕业了，拿了一些奖，再也没有骄傲的资本，正式成为一个普通开发者</li>
<li>买了十几本书，看了一部分，在一些陌生的技术领域还是看视频和博客比较多，人还是有惰性的，喜欢看现成的东西</li>
<li>买了 macbook pro， 算是 2014 年总结里实现最快的东西，果然金钱能解决的问题都不是问题</li>
</ol>
<h4>不足</h4>
<ol>
<li>2014 年总结里的不足之处改进地方不是很多，知识总结不足问题依旧存在、考证之类的都没实现、自己的 App 也没有落实</li>
<li>技术不过硬，面试时底气不足，做出的产品不精致，曾经被实力嘲讽了一下</li>
<li>跳槽太快，主要原因是自我定位不明确和看公司目光不行</li>
<li>运动量不够，2015 年前半年运动比较多，后半年应该各种事情，几乎没怎么运动</li>
<li>写作能力比较弱，讲故事姿势不对</li>
</ol>
<h3>二.2016 展望</h3>
<p>2016 年计划依旧是技术优先</p>
<ul>
<li>报考通过 系统分析师/系统结构师/PMP</li>
<li>把分散在各个角落的笔记收集起来，放在一个平台上，暂时存在 Github</li>
<li>继续多读书，每个月必须有一本到手，读完有思维导图总结</li>
<li>寻找自己感兴趣的项目，改进完善，折腾，这个估计会花费一些业余时间</li>
<li>认识一些朋友，既要避开社交网络的淤泥，又要通过社交网络获取有用信息，还是比较有挑战性的</li>
<li>健身，星期六早上</li>
</ul>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/02/01/20150201_2015-2016/" class="archive-article-date">
  	<time datetime="2016-02-01T13:34:11.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-02-01</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/总结/">总结</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-20150123_DeBug1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/23/20150123_DeBug1/">编程记录2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>实现效果图如下的多选框：
<img src="/img/20150123_checkbox_theme_20.png" alt="效果图"><br>
为了自定义按钮的效果，设置了按钮的背景CheckBox代码如下：
<img src="/img/20150123_checkbox_code.png" alt="效果图"><br>
styles.xml代码如下：
<img src="/img/20150123_checkbox_theme_bug_code.png" alt="效果图"><br>
在4.4系统的效果还不错：
<img src="/img/20150123_checkbox_theme_20.png" alt="效果图"><br>
但是在4.0的系统下却变形了：
<img src="/img/20150123_checkbox_theme_14.png" alt="效果图"><br>
Google得：</p>
<blockquote>
<p>在Android 4.2以下版本，如果使用paddingleft 处理checkbox 会遇到选项框和内容重叠的问题<br>
解决方案有：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">1、推荐方法:</div></pre></td></tr></table></figure></p>
</blockquote>
<p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">checkBox.setButtonDrawable(getResources().getDrawable(R.drawable.eg_checkbox));</div><div class="line"></div><div class="line"><span class="keyword">final</span> <span class="keyword">float</span> scale = <span class="keyword">this</span>.getResources().getDisplayMetrics().density;</div><div class="line">checkBox.setPadding(checkBox.getPaddingLeft() + (<span class="keyword">int</span>)(<span class="number">10.0f</span> * scale + <span class="number">0.5f</span>),</div><div class="line">        checkBox.getPaddingTop(),</div><div class="line">        checkBox.getPaddingRight(),</div><div class="line">        checkBox.getPaddingBottom());</div><div class="line">```</div></pre></td></tr></table></figure></p>
<p>或者</p>
<p>2、第二种方法：如果 R.drawable.eg_checkbox不是selector类型（如果是就用推荐方法），直接是图片可以用：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">```java </div><div class="line">checkBox1.setButtonDrawable(android.R.color.transparent);// 设置它的button的图片为不可见</div><div class="line">checkBox1.setCompoundDrawablesWithIntrinsicBounds(drawable, null, null,null);</div><div class="line"></div><div class="line">final float scale = this.getResources().getDisplayMetrics().density;</div><div class="line">int px = (int)(10.0f * scale + 0.5f)；</div><div class="line">checkBox1.setCompoundDrawablePadding(px);</div><div class="line">```  </div><div class="line">来自：[ Android checkbox padding 兼容问题](http://blog.csdn.net/soldierguard/article/details/22885243) </div><div class="line"> </div><div class="line"> 还有来自[How to: Android – Spacing between CheckBox and text](http://sevennet.org/2014/12/21/how-to-android-spacing-between-checkbox-and-text/)的：</div></pre></td></tr></table></figure></p>
<pre><code>Answer: Android – Spacing between CheckBox and text
</code></pre>
<p>Given @DougW response, what I do to manage version is simpler, I add to my checkbox view:
android:paddingLeft=&quot;@dimen/padding_checkbox&quot;
where the dimen is found in two values folders:
values
&lt;resources&gt; &lt;dimen name=&quot;padding_checkbox&quot;&gt;25dp&lt;/dimen&gt; &lt;/resources&gt;
values-v17 (4.2 JellyBean)
&lt;resources&gt; &lt;dimen name=&quot;padding_checkbox&quot;&gt;10dp&lt;/dimen&gt; &lt;/resources&gt;
I have a custom check, use the dps to your best choice.</p>
<pre><code>最后使用[How to: Android – Spacing between CheckBox and text](http://sevennet.org/2014/12/21/how-to-android-spacing-between-checkbox-and-text/)的方法： 
####在工程里建一个values-v17  
![解决方案](/img/20150123_checkbox_theme_fix2_code.png)  
在values-v17 建styles.xml，大于4.2的使用paddingLeft=12dip的配置： 
![解决方案](/img/20150123_checkbox_theme_fix3_code.png)  
在values的styles.xml中设置小于4.2的值  paddingLeft=25dip
![解决方案](/img/20150123_checkbox_theme_fix1_code.png) 
解决。
</code></pre>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2015/01/23/20150123_DeBug1/" class="archive-article-date">
  	<time datetime="2015-01-23T12:56:01.000Z" itemprop="datePublished"><i class="icon-clock"></i>2015-01-23</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/checkbox-padding兼容/">checkbox padding兼容</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-20150123_DeBug0" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/23/20150123_DeBug0/">编程记录1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>为FrameLayout设置大小的代码如下：
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mAdvertFrame = (FrameLayout) findViewById(R.id.photos_change);</div><div class="line">LayoutInflater mInflater = getLayoutInflater();</div><div class="line">mAdvertFrame.setPadding(<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">0</span>);</div><div class="line"><span class="comment">// 五分之二高度</span></div><div class="line"><span class="keyword">int</span> wheight = getWindowManager().getDefaultDisplay().getHeight();</div><div class="line">wheight = (<span class="keyword">int</span>) (wheight * <span class="number">0.25</span>);</div><div class="line">FrameLayout.LayoutParams frame_params = <span class="keyword">new</span> FrameLayout.LayoutParams(</div><div class="line">		FrameLayout.LayoutParams.MATCH_PARENT, wheight);</div><div class="line">mAdvertFrame.setLayoutParams(frame_params);</div></pre></td></tr></table></figure></p>
<p>结果出现一下错误：
<img src="/img/20150123_error.png" alt="设置LayoutParams错误">
由<a href="http://blog.csdn.net/lilu_leo/article/details/11952717" target="_blank" rel="external">java.lang.ClassCastException: android.widget.FrameLayout$LayoutParams cannot be cast to android.widg</a>查得原因为：
###		LinearLayout为子控件分配空间的时候，获取FrameLayout的LayoutParams的必须为LinearLayout.LayoutParams，而非FrameLayout.LayoutParams。
修改代码如图：
<img src="/img/20150123_fix.png" alt="修改后代码"><br>
解决。</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2015/01/23/20150123_DeBug0/" class="archive-article-date">
  	<time datetime="2015-01-23T12:13:07.000Z" itemprop="datePublished"><i class="icon-clock"></i>2015-01-23</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Exception/">Exception</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-My-New-Page" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/20/My-New-Page/">My New Page</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>##根据<a href="http://www.easydone.cn/2014/01/29/%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8hexo%E5%86%99%E5%8D%9A%E5%AE%A2/" target="_blank" rel="external">开始使用hexo写博客</a>学习hexo的使用，这些是测试文字，接下来我会使用
hexo clean<br>
hexo g<br>
hexo d</p>
<hr>
<p>2016-05-02<br>
修改    hexo g    为    hexo g &amp;&amp; cp CNAME public/<br>
因为目前绑定了域名，需要在首页添加 CNAME 文件<br>
修改 hexo d  为  sudo hexo d</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2015/01/20/My-New-Page/" class="archive-article-date">
  	<time datetime="2015-01-20T03:21:08.000Z" itemprop="datePublished"><i class="icon-clock"></i>2015-01-20</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hexo/">Hexo</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/16/hello-world/">静宏的 2014 -&gt; 2015</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3>一. 2014 总结</h3>
<p>2014 总体还是比较好的，虽然技术上没有到一个让老板放心的高度，对于一些开源项目也只是达到了会用的状态，但也算是入了门。</p>
<h4>成果</h4>
<ol>
<li>2014年3月在学校开始学习Android，到了5月末就开始跟师兄写一个创业项目，因为没有经验，所以效果也是不尽人意，一些常见的常识性错误在所难免，一些复杂一点的界面需要研究实践很久，但也总算是上线了。</li>
<li>拿到了学院的奖学金。虽然只是很小的奖，也不代表什么，但也算是这一年的肯定。</li>
<li>业余时间读了几十本书，都是泛读，但有一些印象比较深刻，应该也会影响到我，比如说《小强升职记》、《人生需要整理》这些时间管理类的书。</li>
<li>开始学会规划时间。对微博、QQ这一类比较消耗注意力的应用的依赖减少了，不像之前读书的时候闲的发慌。效率也提高了不少，真真正正地写代码。</li>
<li>下半年考过了软件设计师，以考促学，学到了一些基础。</li>
<li>学会了上github，但是工作环境比较恶劣，上网都是问题，谷歌更是别说了。。</li>
</ol>
<h4>不足</h4>
<ol>
<li>对Android一些没有用到的部分技术比较弱，没有深入去理解其中的原理。</li>
<li>对于知识不善于总结记录，读过的书想总结却无从下手，所以感觉总是囫囵吞枣。对于遇到过的问题也不善于表达，所以我是属于那80%的内容消费者。</li>
<li>对学习新技术没有强有力的驱动，我很早就有github账号，但是一直都是围观者，今年学习了一下git、python和正则表达式，但是没有什么驱动感觉学了就放一边了，和以前学校的课程一样，所以我打算找一下挑战性的项目来练手。</li>
<li>到目前为止还没有真真正正的提交/分享过代码，实在惭愧，有太多因素，其中主要是技术、时间不足。</li>
<li>在目前的项目上犯了很多错误，不能很有经验地写代码，以至于目前的项目不像主流的APP那样流畅优秀，这也是我的技术比较弱自己摸索的后果。</li>
</ol>
<h3>二. 2015 展望</h3>
<p>2015 还是有很多计划的。</p>
<ul>
<li>打算报考系统分析师/系统结构师。</li>
<li>学习实践GTD、时间管理。</li>
<li>养成记录习惯，实践印象笔记和tudo。</li>
<li>多读书，尤其是技术方面的。</li>
<li>模仿主流的App，亲手做一个出来。</li>
<li>买macbook pro，毕竟电脑是程序员的工具，买一个好点可以节省生命。</li>
<li>学习ios和html5，今年看到了一些Android和html5的混合应用，也想看看是什么原理。</li>
<li>尝试分享记录一些东西，不做旁观者。</li>
<li>尝试从Eclipse转到Android Studio，毕竟很多开源项目都是在Android Studio上面了。</li>
</ul>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2015/01/16/hello-world/" class="archive-article-date">
  	<time datetime="2015-01-16T10:57:33.000Z" itemprop="datePublished"><i class="icon-clock"></i>2015-01-16</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/总结/">总结</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 静宏 <a href="http://www.miitbeian.gov.cn/">粤ICP备16064340号-1</a>
    	</div>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
      	<div class="footer-right">
        本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
   <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/./main.js"></script>





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0-beta.0/MathJax.js">
</script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<a href="/tags/Android/" style="font-size: 12.5px;">Android</a> <a href="/tags/CPU/" style="font-size: 10px;">CPU</a> <a href="/tags/Centos/" style="font-size: 10px;">Centos</a> <a href="/tags/Cronolog/" style="font-size: 10px;">Cronolog</a> <a href="/tags/Error/" style="font-size: 10px;">Error</a> <a href="/tags/EventBus/" style="font-size: 10px;">EventBus</a> <a href="/tags/Exception/" style="font-size: 10px;">Exception</a> <a href="/tags/Guava/" style="font-size: 10px;">Guava</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/JDK-8/" style="font-size: 10px;">JDK 8</a> <a href="/tags/JVM/" style="font-size: 10px;">JVM</a> <a href="/tags/Java/" style="font-size: 17.5px;">Java</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Log/" style="font-size: 10px;">Log</a> <a href="/tags/Method-getAnnotations/" style="font-size: 10px;">Method.getAnnotations()</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/SourceTree/" style="font-size: 10px;">SourceTree</a> <a href="/tags/Spring/" style="font-size: 10px;">Spring</a> <a href="/tags/Subversion/" style="font-size: 10px;">Subversion</a> <a href="/tags/Tomcat/" style="font-size: 10px;">Tomcat</a> <a href="/tags/checkbox-padding兼容/" style="font-size: 10px;">checkbox padding兼容</a> <a href="/tags/git-svn/" style="font-size: 10px;">git svn</a> <a href="/tags/gzip/" style="font-size: 10px;">gzip</a> <a href="/tags/log4j2/" style="font-size: 10px;">log4j2</a> <a href="/tags/logrotate/" style="font-size: 10px;">logrotate</a> <a href="/tags/总结/" style="font-size: 17.5px;">总结</a> <a href="/tags/读书笔记/" style="font-size: 20px;">读书笔记</a>
    			</div>
    	</section>
    

    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">生命不息&lt;/br&gt;冲锋不止!</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>